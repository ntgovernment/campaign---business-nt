function fadeOut(el){el.style.opacity=1,function fade(){(el.style.opacity-=.1)<=0?el.style.display="none":requestAnimationFrame(fade)}()}function fadeIn(el,display){el.style.opacity=0,el.style.display=display||"block",function fade(){var val=parseFloat(el.style.opacity);1<(val+=.1)||(el.style.opacity=val,requestAnimationFrame(fade))}()}!function(global){global.JSONCache=new class{constructor(){this.cache=new Map,this.loading=new Map,this.loadingOverlay=null}async init(){this.showLoadingOverlay("Loading quiz data...");try{var appEl=document.getElementById("app");if(!appEl)throw new Error("App element not found");let urls;var isBusinessHealth="business-health-checklist"===appEl.dataset.quiz,fetchPromises=(urls=isBusinessHealth?{mainNavigation:appEl.dataset.quizMainNavigation,uiMessages:appEl.dataset.uiMessages,businessOperations:appEl.dataset.businessOperations,businessStrategy:appEl.dataset.businessStrategy,financialManagement:appEl.dataset.financialManagement,manageChangeAndPrepareForDisruptions:appEl.dataset.manageChangeAndPrepareForDisruptions,staffAndPeopleManagement:appEl.dataset.staffAndPeopleManagement,understandYourCustomers:appEl.dataset.understandYourCustomers}:{mainNavigation:appEl.dataset.quizMainNavigation||"../assets/data/mainNavigation.json",uiMessages:appEl.dataset.uiMessages||"../assets/data/uiMessages.json",propertySafety:appEl.dataset.propertySafety,staffSafety:appEl.dataset.staffSafety,mobileBusiness:appEl.dataset.mobileBusiness,vehicleSafety:appEl.dataset.vehicleSafety},Object.entries(urls).filter(([,url])=>url).map(([key,url])=>this.fetchWithCache(url).then(data=>({key:key,url:url,data:data})))),results=await Promise.all(fetchPromises);return this.hideLoadingOverlay(),results}catch(error){throw this.hideLoadingOverlay(),this.showError("Failed to load quiz data. Please refresh the page."),error}}async fetchWithCache(url){if(this.loading.has(url))return this.loading.get(url);var cached=this.cache.get(url);if(cached)return this.validateCache(url,cached),cached.data;cached=this.fetchJSON(url);this.loading.set(url,cached);try{var result=await cached;return this.loading.delete(url),result}catch(error){throw this.loading.delete(url),error}}async fetchJSON(url){const response=await fetch(url);if(!response.ok)throw new Error(`Failed to fetch ${url}: `+response.statusText);var data=await response.json(),etag=response.headers.get("ETag"),lastModified=response.headers.get("Last-Modified");return this.cache.set(url,{data:data,etag:etag,lastModified:lastModified,timestamp:Date.now()}),data}async validateCache(url,cached){try{const response=await fetch(url,{method:"HEAD"});var etag=response.headers.get("ETag"),lastModified=response.headers.get("Last-Modified");(etag&&etag!==cached.etag||lastModified&&lastModified!==cached.lastModified)&&(this.cache.delete(url),await this.fetchJSON(url))}catch(error){console.warn("Cache validation failed:",error)}}async get(url){return this.fetchWithCache(url)}clear(){this.cache.clear(),this.loading.clear()}showLoadingOverlay(message="Loading..."){this.loadingOverlay||(this.loadingOverlay=document.createElement("div"),this.loadingOverlay.className="quiz-loading-overlay",this.loadingOverlay.innerHTML=`
                <div class="quiz-loading-content">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">${message}</p>
                </div>
            `,document.body.appendChild(this.loadingOverlay))}hideLoadingOverlay(){this.loadingOverlay&&(this.loadingOverlay.remove(),this.loadingOverlay=null)}showError(message){const errorDiv=document.createElement("div");errorDiv.className="alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3",errorDiv.style.zIndex="9999",errorDiv.innerHTML=`
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `,document.body.appendChild(errorDiv),setTimeout(()=>{errorDiv.remove()},5e3)}}}(window);var LZString={compressToEncodedURIComponent:function(input){if(null==input)return"";try{var encoded=unescape(encodeURIComponent(input)),b64=btoa(encoded);return encodeURIComponent(b64)}catch(e){return console.warn("LZString fallback compress failed",e),encodeURIComponent(input)}},decompressFromEncodedURIComponent:function(input){if(null==input)return null;try{var b64=decodeURIComponent(input),str=atob(b64);return decodeURIComponent(escape(str))}catch(e){console.warn("LZString fallback decompress failed",e);try{return decodeURIComponent(input)}catch(e2){return input}}}};function initSameHeight(){$(".ntg-image-card-carousel .card .card-body, .same-height").sameHeight({flexible:!0,multiLine:!0,biggestHeight:!0})}function initMegaMenu(){ResponsiveHelper.addRange({"1200..":{on:function(){$(".ntg-main-nav__wrapper").accessibleMegaMenu("init"),$(".ntg-main-nav__panel").css("display","block")},off:function(){$(".ntg-main-nav__wrapper").accessibleMegaMenu("destroy")}}});const header=document.querySelector(".page-header-container"),navLinks=document.querySelectorAll(".ntg-main-nav__link > a");var openPanel=!1,lastScrollTop=(navLinks.forEach(function(link){const observer=new MutationObserver((mutationList,observer)=>{for(const mutation of mutationList)if("attributes"===mutation.type){var scrollPosition=scrollY;for(i=0;i<navLinks.length;i++){if(navLinks[i].classList.contains("open")){header.classList.add("header-scroll"),openPanel=!0;break}scrollPosition<=100&&header.classList.remove("header-scroll"),openPanel=!1}}});observer.observe(link,{attributes:!0})}),0);window.addEventListener("scroll",function(){var scrollTop=window.scrollY,scrollUp=scrollTop<lastScrollTop;if(Math.abs(lastScrollTop-scrollTop)<=5)return!1;scrollUp?scrollTop<=100&&(openPanel||header.classList.remove("header-scroll")):100<scrollTop&&(openPanel||header.classList.add("header-hide")),lastScrollTop=scrollTop}),window.addEventListener("resize",function(){var scrollPosition=scrollY;window.matchMedia("(max-width: 1200px)")&&scrollPosition<=100&&header.classList.remove("header-scroll"),window.matchMedia("(min-width: 1200px)")&&openPanel&&header.classList.add("header-scroll")}),document.querySelectorAll(".ntg-main-nav__panel").forEach(function(panel){var columns=panel.querySelector(".ntg-main-nav__panel-columns");if(!columns)return!1;columns.childElementCount<=1&&panel.classList.add("one-group")})}function initAddHoverClassOnCardHover(){const linkCards=document.querySelectorAll(".card--link-card");linkCards.forEach(card=>{card.addEventListener("mouseover",()=>{card.classList.add("hover")}),card.addEventListener("mouseout",()=>{card.classList.remove("hover")}),card.addEventListener("focus",()=>{card.classList.add("hover")}),card.addEventListener("blur",()=>{card.classList.remove("hover")})})}function initLinkCheck(){var links=document.querySelectorAll("#content a");if(!links)return!1;links.forEach(function(link){var arr=link.getAttribute("href").split(".");if(location.hostname!==link.hostname&&link.hostname.length)link.classList.add("external-link"),link.classList.contains("btn")?link.classList.add("btn-external"):(window.getComputedStyle(link).getPropertyValue("font-weight"),link.querySelector('[class*="fa-arrow-up-right-from-square"]')||link.querySelector("img")||link.querySelector('[class*="fa-brands"]')||link.insertAdjacentHTML("beforeend",'<i class="fa-solid fa-arrow-up-right-from-square ms-1 aria-hidden="true"></i>')),link.setAttribute("rel","noopener"),link.setAttribute("title","Opens in a new window"),link.setAttribute("target","_blank");else{if("pdf"!==arr[arr.length-1])return!1;link.setAttribute("rel","noopener"),link.setAttribute("title","Opens in a new window"),link.setAttribute("target","_blank")}})}function initPriorityNav(){if(!document.querySelector(".ntg-main-nav"))return!1;new PriorityNav(".ntg-main-nav")}function initResponsiveMenu(){if(!document.getElementById("mainmenu"))return!1;responsivemenu.init({wrapper:document.querySelector("#mainmenu")})}function initMmenu(){const mmenuWrapper=document.getElementById("mmenu-wrapper"),pageHeader=document.getElementsByClassName("page-header-container")[0];if(!mmenuWrapper)return!1;pageHeader.getAttribute("data-bs-theme")&&mmenuWrapper.setAttribute("data-bs-theme",pageHeader.getAttribute("data-bs-theme")),document.addEventListener("DOMContentLoaded",()=>{let options={offCanvas:{position:"right-front"}};mmenuWrapper.getAttribute("data-btn-link")&&mmenuWrapper.getAttribute("data-btn-text")&&(btnContent=`<a role="button" class="btn btn-light d-flex btn-mmenu" href="${mmenuWrapper.getAttribute("data-btn-link")}">${mmenuWrapper.getAttribute("data-btn-text")}</a>`,mmenuWrapper.removeAttribute("data-btn-link"),mmenuWrapper.removeAttribute("data-btn-text"),options.navbars=[{use:!0,position:"bottom",content:btnContent}]);const API=new Mmenu("#mmenu-wrapper",options).API;window.addEventListener("resize",function(){window.matchMedia("(min-width: 992px)").matches&&API.close()});var btnContent=document.querySelector(".mm-panels"),close=document.createElement("a");close.setAttribute("class","mm-btn mm-btn--close-wrapper mm-navbar__btn"),close.setAttribute("aria-label","Close menu"),close.setAttribute("href","#wrapper"),close.innerHTML=`<div class="mm-btn--close">
                                <span class="top-line" aria-hidden="true"></span>
                                <span class="bot-line" aria-hidden="true"></span>
                            </div>
                            <span class="mm-btn--close__text">Close</span>`,btnContent.prepend(close)})}function initMenuEdge(){var links=document.querySelectorAll(".ntg-main-nav__links > li");if(!links)return!1;links.forEach(link=>{var second=link.querySelector("ul > li > ul"),third=link.querySelector("ul > li > ul > li > ul");function avoidEdge(){var offset,left=offset(link).left,wnWidth=window.innerWidth,isSecondVisible=left+300<=wnWidth;function offset(elem){return{left:elem.getBoundingClientRect().left+window.scrollX}}left+600<=wnWidth?link.classList.remove("edge"):link.classList.add("edge"),isSecondVisible?link.classList.remove("all"):link.classList.add("all")}!second&&!third||link.classList.contains("more")||(link.addEventListener("mouseenter",function(){avoidEdge()}),link.addEventListener("keydown",function(){avoidEdge()}),link.addEventListener("touchstart",function(){avoidEdge()}))})}function initSuperfish(){$(function(){$("ul.sf-menu").superfish({delay:250,speed:250,speedOut:250,cssArrows:!1})})}function initStickyHeader(){var header=document.querySelector(".page-header-container"),banner=document.querySelector(".ntg-banner");(banner?new StickyHeader(header,banner):new StickyHeader(header)).init()}function initInPageNav(){var inPageNav=document.getElementById("in-page-nav");if(!inPageNav)return!1;var list=inPageNav.querySelector("ul");document.querySelectorAll("#content h2").forEach(function(element,index){if(0===index)return!1;element.querySelector("a")&&(element=element.querySelector("a")).parentElement,list.insertAdjacentHTML("beforeend",'<li><a href="#'+element.innerText.replace(/&amp;/g,"and").replace(/[^a-z0-9 ]/gi,"").replace(/\s/g,"-").toLowerCase()+'">'+element.innerText+"</a></li>"),element.setAttribute("id",element.innerText.replace(/&amp;/g,"and").replace(/[^a-z0-9 ]/gi,"").replace(/\s/g,"-").toLowerCase())})}function initSideNav(){var sideNavParents=document.querySelectorAll(".ntg-side-nav__collapser");if(!sideNavParents)return!1;for(var i=0;i<sideNavParents.length;i++)sideNavParents[i].addEventListener("click",function(e){e.preventDefault();e=this.parentElement.getElementsByClassName("collapse")[0];e.classList.contains("show")?(e.classList.remove("show"),this.classList.add("collapsed")):(e.classList.add("show"),this.classList.remove("collapsed"))})}function initScrollToTop(){var backToTop=document.querySelector(".back-to-top");if(!backToTop)return!1;var backToTopLink=backToTop.querySelector(".back-to-top button"),footer=document.querySelector(".ntg-footer"),isGoUpOn=!1;function checkFooterPosition(){var scrollBottom=document.body.clientHeight-document.documentElement.clientHeight-document.documentElement.scrollTop;scrollBottom<footer.offsetHeight?backToTop.style.marginBottom=footer.offsetHeight-scrollBottom+"px":backToTop.style.marginBottom=0}window.addEventListener("scroll",function(){isGoUpOn?window.pageYOffset<=500&&(fadeOut(backToTop),isGoUpOn=!1):500<window.pageYOffset&&(isGoUpOn=!0,fadeIn(backToTop)),checkFooterPosition()}),window.addEventListener("resize",function(){checkFooterPosition()}),backToTopLink.addEventListener("click",function(e){e.preventDefault(),document.querySelector("header a").focus({preventScroll:!0}),scroll({top:0,left:0,behavior:"smooth"})})}function initResponsiveTable(){document.querySelectorAll('[class*="custom-table-"]').forEach(function(element){responsiveCellHeaders(element),addTableAria(element)})}function initFlickity(){var carousels=document.querySelectorAll(".flickity-carousel");if(!carousels)return!1;carousels.forEach(function(carousel){var alignment=(alignment=carousel.getAttribute("data-align"))||"center",flkty=new Flickity(carousel,{cellAlign:alignment,pageDots:!1,on:{ready:function(){setSliderHeightToMax(this)}}});const cellElements=flkty.getCellElements();for(let i=0;i<cellElements.length;i++){const links=cellElements[i].querySelectorAll("a");0<links.length&&links.forEach(link=>{link.addEventListener("focus",e=>{flkty.select(i)})})}function setSliderHeightToMax(slider){slider.cells.forEach(cell=>cell.element.style.height="");let heights=slider.cells.map(cell=>cell.element.offsetHeight),max=Math.max.apply(Math,heights);slider.cells.forEach(cell=>cell.element.style.height=max+"px")}window.addEventListener("resize",function(){setSliderHeightToMax(flkty)})})}function toggleCarouselButton(){var carousels=document.querySelectorAll(".carousel"),paused=!1,initializedCarousels=[];carousels.forEach(carousel=>{let carouselOptions={ride:"carousel"};isNaN(parseInt(carousel.getAttribute("data-bs-interval")))?(carouselOptions.interval=!1,carouselOptions.ride=!1):(console.log(parseInt(carousel.getAttribute("data-bs-interval"))),carouselOptions.interval=parseInt(carousel.getAttribute("data-bs-interval")));carousel=new bootstrap.Carousel(carousel,carouselOptions);initializedCarousels.push(carousel)}),initializedCarousels.forEach(function(carousel){let bootstrapCarousel=carousel;const toggleButton=carousel._element.querySelector(".toggleCarouselBtn");if(toggleButton){let playPauseIcon=toggleButton.querySelector("i");toggleButton.addEventListener("click",function(e){paused=paused?(bootstrapCarousel.cycle(),bootstrapCarousel._config.ride="carousel",playPauseIcon.classList.remove("fa-play"),playPauseIcon.classList.add("fa-pause"),!1):(bootstrapCarousel.pause(),bootstrapCarousel._config.ride=!1,playPauseIcon.classList.remove("fa-pause"),playPauseIcon.classList.add("fa-play"),!0)})}})}function initCountUp(){document.querySelectorAll(".count-up").forEach(function(value){var target=value.innerHTML.replace(/[^\d.]/g,""),decimalPlaces=0,prefix="",suffix="";target.includes(".")&&(decimalPlaces=target.split(".")[1].length),value.hasAttribute("data-prefix")&&(prefix=value.getAttribute("data-prefix")),value.hasAttribute("data-suffix")&&(suffix=value.getAttribute("data-suffix")),new CountUp(value,target,{decimalPlaces:decimalPlaces,duration:3,prefix:prefix,suffix:suffix,enableScrollSpy:!0,scrollSpyOnce:1})})}function initResizeButtons(){function handleSizing(e,breakpoint){$(window).width()<=breakpoint?e.addClass("btn-sm"):e.removeClass("btn-sm")}$(".btn:not(.btn-sm)").each(function(){var btn=$(this);handleSizing(btn,974),$(window).on("resize",function(){handleSizing(btn,974)})})}function initResponsivePagination(){var pagination=document.querySelectorAll(".pagination");if(!pagination)return!1;function hidePageItems(elems){if(window.matchMedia("(max-width: 992px)").matches){if(5<elems.length)for(let i=0;i<elems.length;i++){var elem=elems[i];4<i&&!elem.classList.contains("d-none")&&elem.classList.add("d-none")}}else for(let i=0;i<elems.length;i++)(elem=elems[i]).classList.contains("d-none")&&elem.classList.remove("d-none")}pagination.forEach(e=>{var items=e.querySelectorAll(".page-item:not(.exclude)");hidePageItems(items),window.addEventListener("resize",function(){hidePageItems(items)})})}function initVideoControl(){document.querySelectorAll(".video-control").forEach(function(btn){btn.addEventListener("click",function(){var e=btn,videoID=e.getAttribute("data-video");(videoID=videoID&&document.getElementById(videoID))&&(e.classList.contains("pause")?(e.classList.remove("pause"),e.classList.add("play"),videoID.pause()):e.classList.contains("play")&&(e.classList.remove("play"),e.classList.add("pause"),videoID.play()))})})}function initQuizUI(){function updateStepperProgress(){const stepper=document.querySelector(".stepper");if(stepper){var stepperWidth,activeStepRect,stepperRect,steps=stepper.querySelectorAll(".step");if(0!==steps.length){const activeStep=stepper.querySelector(".step.active");activeStep&&(stepperWidth=(stepperRect=stepper.getBoundingClientRect()).width,stepperRect=(activeStepRect=activeStep.getBoundingClientRect()).left-stepperRect.left+activeStepRect.width/2,activeStepRect=Math.max(0,Math.min(100,stepperRect/stepperWidth*100)),0===(stepperRect=Array.from(steps).indexOf(activeStep))?stepper.style.setProperty("--progress-width","0%"):stepperRect===steps.length-1?stepper.style.setProperty("--progress-width","100%"):stepper.style.setProperty("--progress-width",activeStepRect+"%"))}}}updateStepperProgress(),window.addEventListener("stepperUpdated",updateStepperProgress),window.addEventListener("resize",updateStepperProgress)}window.State={currentState:{view:"start",quizId:null,currentPage:0,answers:{}},encodeState(stateObj){stateObj=JSON.stringify(stateObj);return LZString.compressToEncodedURIComponent(stateObj)},decodeState(str){if(!str)return null;try{var json=LZString.decompressFromEncodedURIComponent(str);return JSON.parse(json)}catch(e){return console.warn("Failed to decode state",e),null}},saveStateToUrl(stateObj,skipHashChange=!1){var stateObj=this.encodeState(stateObj),scrollX=window.scrollX,scrollY=window.scrollY;skipHashChange?(skipHashChange="#?state="+stateObj,window.location.hash!==skipHashChange&&history.replaceState(null,"",skipHashChange)):window.location.hash="#?state="+stateObj,window.scrollTo(scrollX,scrollY)},loadStateFromUrl(){const hash=window.location.hash||"";var parts=hash.split("?");if(parts.length<2)return null;parts=parts[1];const params=new URLSearchParams(parts);parts=params.get("state");return parts?this.decodeState(parts):null},clearState(){window.location.hash="#"}},window.Conditional={isVisible(question,answers){if(!question.conditional||!question.conditional.showWhen)return!0;var rule=question.conditional.showWhen;for(const key in rule){const expected=rule[key];var actual=answers[key];if(Array.isArray(expected)){if(!expected.includes(actual))return!1}else if(actual!==expected)return!1}return!0}},window.Modal={init(){this.modalEl=document.getElementById("resumeModal"),this.modal=new bootstrap.Modal(this.modalEl),this.btnResume=document.getElementById("btnResume"),this.btnFresh=document.getElementById("btnFresh"),this.btnResume.addEventListener("click",()=>{this.hide(),document.dispatchEvent(new CustomEvent("modal:resume"))}),this.btnFresh.addEventListener("click",()=>{this.hide(),document.dispatchEvent(new CustomEvent("modal:fresh"))})},show(){this.modal.show()},hide(){this.modal.hide()}},function(){async function fetchJSON(path){return window.JSONCache.get(path)}function getQuizUrl(quizId){var appEl=document.getElementById("app");return appEl?"business-health-checklist"===appEl.dataset.quiz?appEl.dataset[quizId.toLowerCase()]?appEl.dataset[quizId.toLowerCase()]:`../assets/business-health-checklist-quiz/quizzes/${quizId}.json`:appEl.dataset[quizId]||`../assets/data2/quizzes/${quizId}.json`:`../assets/data/quizzes/${quizId}.json`}function isPageCompleted(page,answers){for(const q of page.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var ans=answers[subQ.id];if(null==ans||""===ans)return!1;if(Array.isArray(ans)&&0===ans.length)return!1}}else if(Conditional.isVisible(q,answers)){const ans=answers[q.id];if(void 0===ans||null===ans||""===ans)return!1;if(Array.isArray(ans)&&0===ans.length)return!1}return 0<page.questions.length&&page.questions.some(q=>"group"===q.type&&q.subQuestions?q.subQuestions.some(subQ=>Conditional.isVisible(subQ,answers)):Conditional.isVisible(q,answers))}function showInlineMessageForQuestion(question,questionEl,value){if(questionEl){const msgDiv=questionEl.querySelector(".inline-message");if(msgDiv&&(msgDiv.style.display="none",msgDiv.innerHTML="",question.messageOnSelect)){let payload=null;if("string"==typeof question.messageOnSelect?payload=question.messageOnSelect:value&&question.messageOnSelect[value]?payload=question.messageOnSelect[value]:question.messageOnSelect["*"]&&(payload=question.messageOnSelect["*"]),payload){if("string"==typeof payload)return msgDiv.innerHTML=payload,msgDiv.classList.remove("info-box"),void(msgDiv.style.display="block");questionEl=payload.class||"info-box";if(msgDiv.className="inline-message "+questionEl,payload.html)msgDiv.innerHTML=payload.html;else{let out="";payload.title&&(out+=`<strong>${payload.title}</strong>`),payload.body&&(out+=`<div>${payload.body}</div>`),msgDiv.innerHTML=out}msgDiv.style.display="block"}}}}function updatePageMessages(quiz,page){const messagesSection=document.getElementById("pageMessages");if(messagesSection){var ans,answers=window.State.currentState.answers||{};const messages={positive:[],recommendation:[]};for(const q of page.questions)if("group"===q.type&&q.subQuestions){let hasPositive=!1,hasNegative=!1;for(const subQ of q.subQuestions)Conditional.isVisible(subQ,answers)&&(ans=answers[subQ.id],"radio"===subQ.type&&(shouldShowMessage(subQ,ans,"positive")&&(hasPositive=!0),shouldShowMessage(subQ,ans,"recommendation")&&(hasNegative=!0)));hasPositive&&q.positiveMessage&&messages.positive.push(q.positiveMessage),hasNegative&&q.recommendation&&messages.recommendation.push(q.recommendation)}var page=JSON.stringify(messages),currentMessageKeys=messagesSection.dataset.messageKeys||"";if(page!==currentMessageKeys&&(messagesSection.dataset.messageKeys=page,messagesSection.innerHTML="",0<messages.positive.length||0<messages.recommendation.length)){const heading=document.createElement("h3");heading.textContent="Feedback",messagesSection.appendChild(heading),messages.positive.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item positive",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messagesSection.appendChild(msgDiv)}),messages.recommendation.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item recommendation",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messagesSection.appendChild(msgDiv)})}}}function shouldShowMessage(question,answer,messageType){if(answer){if("positive"===messageType&&question.positiveMessageOn)return question.positiveMessageOn.includes(answer);if("recommendation"===messageType&&question.recommendationOn)return question.recommendationOn.includes(answer);if("radio"===question.type){if("positive"===messageType)return question.showRecommendationOnYes?"No"===answer:"Yes"===answer;if("recommendation"===messageType)return question.showRecommendationOnYes?"Yes"===answer:"No"===answer||"Unsure"===answer}}}function updateInlineQuestionMessages(quiz,page){var answers=window.State.currentState.answers||{};for(const q of page.questions)if("group"!==q.type||!q.subQuestions){const qEl=document.querySelector(`.question[data-qid="${q.id}"]`);if(qEl){const messageContainer=qEl.querySelector(".question-message");if(messageContainer)if(Conditional.isVisible(q,answers)){var ans=answers[q.id];let messageToShow=null;if("radio"===q.type&&(shouldShowMessage(q,ans,"positive")&&q.positiveMessage?messageToShow={...q.positiveMessage,type:"positive"}:shouldShowMessage(q,ans,"recommendation")&&q.recommendation&&(messageToShow={...q.recommendation,type:"recommendation"})),messageToShow){ans=JSON.stringify(messageToShow);if(ans!==(messageContainer.dataset.messageKey||"")){messageContainer.dataset.messageKey=ans,messageContainer.innerHTML="";const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item "+messageToShow.type,document.createElement("div")),body=(title.className="message-title",title.textContent=messageToShow.title,document.createElement("div"));body.className="message-body",body.innerHTML=messageToShow.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messageContainer.appendChild(msgDiv)}}else messageContainer.innerHTML="",messageContainer.dataset.messageKey=""}else messageContainer.innerHTML=""}}}function updateConditionalGroupMessages(quiz,page){const answers=window.State.currentState.answers||{},conditionalGroups=document.querySelectorAll(".conditional-group-message");conditionalGroups.forEach(messageContainer=>{const parentQid=messageContainer.dataset.parentQid;if(parentQid){let parentQuestion=null;if(!(parentQuestion=page.questions.find(q=>q.id===parentQid)))for(const q of page.questions)if("group"===q.type&&q.subQuestions&&(parentQuestion=q.subQuestions.find(sq=>sq.id===parentQid)))break;if(parentQuestion){const messages={positive:[],recommendation:[]};let shouldShowPositive=!1,shouldShowRecommendation=!1;const wrapper=messageContainer.closest(".conditional-subquestion-group, .conditional-group");if(wrapper){const childQuestions=wrapper.querySelectorAll(".sub-question, .question");childQuestions.forEach(childEl=>{var childQuestion,childEl=childEl.dataset.qid;childEl!==parentQid&&(childQuestion=findQuestionInQuiz(quiz,childEl))&&childQuestion.conditional&&childQuestion.conditional.showWhen&&Object.keys(childQuestion.conditional.showWhen)[0]===parentQid&&Conditional.isVisible(childQuestion,answers)&&(childEl=answers[childEl],"radio"===childQuestion.type&&(shouldShowMessage(childQuestion,childEl,"positive")&&(shouldShowPositive=!0),shouldShowMessage(childQuestion,childEl,"recommendation")&&(shouldShowRecommendation=!0)))})}shouldShowPositive&&parentQuestion.conditionalQuestionGroupPositiveMessage&&(messages.positive.some(m=>m.title===parentQuestion.conditionalQuestionGroupPositiveMessage.title)||messages.positive.push(parentQuestion.conditionalQuestionGroupPositiveMessage)),shouldShowRecommendation&&parentQuestion.conditionalQuestionGroupRecommendation&&(messages.recommendation.some(m=>m.title===parentQuestion.conditionalQuestionGroupRecommendation.title)||messages.recommendation.push(parentQuestion.conditionalQuestionGroupRecommendation));var newMessageKeys=JSON.stringify(messages);newMessageKeys!==(messageContainer.dataset.messageKey||"")&&(messageContainer.dataset.messageKey=newMessageKeys,messageContainer.innerHTML="",(0<messages.positive.length||0<messages.recommendation.length)&&(messages.positive.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item positive",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messageContainer.appendChild(msgDiv)}),messages.recommendation.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item recommendation",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messageContainer.appendChild(msgDiv)})))}}})}function findQuestionInQuiz(quiz,qid){for(const page of quiz.pages)for(const q of page.questions){if(q.id===qid)return q;if("group"===q.type&&q.subQuestions)for(const subQ of q.subQuestions)if(subQ.id===qid)return subQ}return null}function updateConditionalGroupBorders(quiz){const wrappers=document.querySelectorAll(".conditional-subquestion-group");wrappers.forEach(wrapper=>{const subQuestions=wrapper.querySelectorAll(".sub-question");let hasConditional=!1;subQuestions.forEach(sq=>{sq=sq.dataset.qid,sq=findQuestionInQuiz(quiz,sq);sq&&sq.conditional&&sq.conditional.showWhen&&(hasConditional=!0)});var hasClass=wrapper.classList.contains("has-visible-conditional");hasConditional&&!hasClass?wrapper.classList.add("has-visible-conditional"):!hasConditional&&hasClass&&wrapper.classList.remove("has-visible-conditional")})}window.UI={renderStart:async function(contentEl,uiMessages){document.getElementById("pageTitle").textContent=uiMessages.introTitle||"Get Started",contentEl.innerHTML="";const wrapper=document.createElement("div"),p=document.createElement("div"),nav=(p.innerHTML=uiMessages.introText||"Start the quizzes to assess your business safety.",document.createElement("div")),btn=(nav.className="nav-buttons",document.createElement("button")),territoryBtn=(btn.className="primary",btn.textContent="Choose a topic",btn.addEventListener("click",()=>{window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState)}),nav.appendChild(btn),wrapper.appendChild(p),wrapper.appendChild(nav),contentEl.appendChild(wrapper),document.getElementById("territoryBusinessAdvisorModal"));territoryBtn&&territoryBtn.addEventListener("click",function(e){if(e.preventDefault(),(e=document.getElementById("floatingContact"))&&window.bootstrap&&window.bootstrap.Modal){const modal=new window.bootstrap.Modal(e);modal.show()}else window.location.href="https://business.nt.gov.au/contact"})},renderChooseTopic:async function(contentEl,navJson){document.getElementById("pageTitle").textContent="Choose a Topic",contentEl.innerHTML="";const grid=document.createElement("div");grid.className="cards";for(const q of navJson.quizzes){const card=document.createElement("div"),imageWrap=(card.className="card quiz-card",document.createElement("div")),img=(imageWrap.className="card-image",document.createElement("img")),content=(img.src=q.icon||"../assets/images/quiz-placeholder.jpg",img.alt=q.title,imageWrap.appendChild(img),document.createElement("div")),title=(content.className="card-content",document.createElement("h3")),desc=(title.textContent=q.title,document.createElement("p")),startBtn=(desc.textContent=q.description,document.createElement("a")),progressWrap=(startBtn.className="card-link",startBtn.textContent="Take the Questionnaire",startBtn.innerHTML='Take the Questionnaire <i class="fa-solid fa-chevron-right"></i>',startBtn.href="#",startBtn.addEventListener("click",e=>{e.preventDefault(),window.State&&(window.State.currentState.view="quiz",window.State.currentState.quizId=q.id,window.State.currentState.currentPage=0,window.State.currentState.answers||(window.State.currentState.answers={}),window.State.saveStateToUrl(window.State.currentState))}),content.appendChild(title),content.appendChild(desc),content.appendChild(startBtn),document.createElement("div"));progressWrap.className="card-progress";var percent=await async function(quizId){try{var ans,quiz=await fetchJSON(getQuizUrl(quizId)),answers=window.State&&window.State.currentState&&window.State.currentState.answers||{};let total=0,answered=0;for(const page of quiz.pages)for(const question of page.questions)if("group"===question.type&&question.subQuestions)for(const subQ of question.subQuestions)Conditional.isVisible(subQ,answers)&&(total++,null!=(ans=answers[subQ.id])&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++);else if(Conditional.isVisible(question,answers)){total++;const ans=answers[question.id];void 0!==ans&&null!==ans&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++}return total?Math.round(answered/total*100):0}catch(e){return 0}}(q.id);const circleProgress=document.createElement("div"),svg=(circleProgress.className="circle-progress",document.createElementNS("http://www.w3.org/2000/svg","svg")),circleBg=(svg.setAttribute("width","100"),svg.setAttribute("height","100"),svg.setAttribute("viewBox","0 0 100 100"),document.createElementNS("http://www.w3.org/2000/svg","circle")),circleFill=(circleBg.setAttribute("cx","50"),circleBg.setAttribute("cy","50"),circleBg.setAttribute("r","45"),circleBg.setAttribute("fill","none"),circleBg.setAttribute("stroke","#e0e0e0"),circleBg.setAttribute("stroke-width","8"),document.createElementNS("http://www.w3.org/2000/svg","circle")),percentLabel=(circleFill.setAttribute("cx","50"),circleFill.setAttribute("cy","50"),circleFill.setAttribute("r","45"),circleFill.setAttribute("fill","none"),circleFill.setAttribute("stroke","#0093b8"),circleFill.setAttribute("stroke-width","8"),circleFill.setAttribute("stroke-dasharray","283"),circleFill.setAttribute("stroke-dashoffset",String(283-283*percent/100)),circleFill.setAttribute("transform","rotate(-90 50 50)"),svg.appendChild(circleBg),svg.appendChild(circleFill),document.createElement("div"));percentLabel.className="percent-label",percentLabel.innerHTML=`<strong>${percent}%</strong><br><span>Complete</span>`,circleProgress.appendChild(svg),circleProgress.appendChild(percentLabel),progressWrap.appendChild(circleProgress),card.appendChild(imageWrap),card.appendChild(content),card.appendChild(progressWrap),grid.appendChild(card)}contentEl.appendChild(grid)},renderQuizPage:async function(contentEl,quizId,pageIndex){document.getElementById("pageTitle").textContent="Quiz",contentEl.innerHTML="";const quiz=await fetchJSON(getQuizUrl(quizId));if(quiz){window.State&&(window.State.currentState.quizId=quizId);const stepper=document.createElement("div"),answers=(stepper.className="stepper",window.State.currentState.answers||{}),resultsStep=(quiz.pages.forEach((p,idx)=>{const s=document.createElement("a"),t=(s.href="#",s.className="step",document.createElement("span"));t.textContent=p.title||"Page "+(idx+1),s.appendChild(t);var pageComplete=isPageCompleted(p,answers);let pageHasAnswers=!1;for(const q of p.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var a=answers[subQ.id];if(null!=a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}if(pageHasAnswers)break}else if(Conditional.isVisible(q,answers)){const a=answers[q.id];if(void 0!==a&&null!==a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}pageComplete?s.classList.add("completed"):pageHasAnswers&&s.classList.add("in-progress"),idx===pageIndex?s.classList.add("active"):idx<pageIndex&&s.classList.add("completed"),s.addEventListener("click",e=>{e.preventDefault(),window.State.currentState.view="quiz",window.State.currentState.currentPage=idx,window.State.saveStateToUrl(window.State.currentState)}),stepper.appendChild(s)}),document.createElement("a")),resultsText=(resultsStep.href="#",resultsStep.className="step",document.createElement("span")),page=(resultsText.textContent="Your results",resultsStep.appendChild(resultsText),resultsStep.addEventListener("click",e=>{e.preventDefault(),window.State.currentState.view="results",window.State.saveStateToUrl(window.State.currentState)}),stepper.appendChild(resultsStep),contentEl.appendChild(stepper),window.dispatchEvent(new CustomEvent("stepperUpdated")),quiz.pages[pageIndex]),pageTitle=document.createElement("div"),qwraps=(pageTitle.className="page-title",pageTitle.textContent=page.title,contentEl.appendChild(pageTitle),[]),idToIndex=(page.questions.forEach(question=>{if("group"===question.type){const groupWrap=document.createElement("div"),groupHeader=(groupWrap.className="question-group",groupWrap.dataset.qid=question.id,document.createElement("div"));if(groupHeader.className="question-group-header",question.helpText){const labelWrapper=document.createElement("div"),label=(labelWrapper.className="question-label-wrapper",document.createElement("label")),helpIcon=(label.textContent=question.label||question.id,document.createElement("button"));helpIcon.type="button",helpIcon.className="help-icon",helpIcon.textContent="i",helpIcon.setAttribute("data-bs-toggle","tooltip"),helpIcon.setAttribute("data-bs-placement","top"),helpIcon.setAttribute("data-bs-title",question.helpText),labelWrapper.appendChild(label),labelWrapper.appendChild(helpIcon),groupHeader.appendChild(labelWrapper)}else{const label=document.createElement("label");label.textContent=question.label||question.id,groupHeader.appendChild(label)}if(groupWrap.appendChild(groupHeader),question.subQuestions&&0<question.subQuestions.length){const subQMap={},conditionalGroups=(question.subQuestions.forEach((subQ,idx)=>{subQMap[subQ.id]=idx}),{}),processed=(question.subQuestions.forEach((subQ,idx)=>{subQ.conditional&&subQ.conditional.showWhen&&(subQ=Object.keys(subQ.conditional.showWhen)[0],void 0!==subQMap[subQ]&&(subQ=subQMap[subQ],conditionalGroups[subQ]=conditionalGroups[subQ]||[],conditionalGroups[subQ].push(idx)))}),new Set);question.subQuestions.forEach((subQ,idx)=>{if(!processed.has(idx))if(conditionalGroups[idx]){const condWrapper=document.createElement("div");condWrapper.className="conditional-subquestion-group";var parentEl=createQuestionElement(subQ,!0);condWrapper.appendChild(parentEl),processed.add(idx),conditionalGroups[idx].forEach(childIdx=>{var childEl=createQuestionElement(question.subQuestions[childIdx],!0);condWrapper.appendChild(childEl),processed.add(childIdx)});const conditionalGroupMessageDiv=document.createElement("div");conditionalGroupMessageDiv.className="conditional-group-message",conditionalGroupMessageDiv.dataset.parentQid=subQ.id,condWrapper.appendChild(conditionalGroupMessageDiv),groupWrap.appendChild(condWrapper)}else{parentEl=createQuestionElement(subQ,!0);groupWrap.appendChild(parentEl),processed.add(idx)}})}qwraps.push(groupWrap)}else qwraps.push(createQuestionElement(question,!1))}),{}),groups=(page.questions.forEach((q,i)=>idToIndex[q.id]=i),{}),appended=(page.questions.forEach((q,i)=>{q.conditional&&q.conditional.showWhen&&((q=Object.keys(q.conditional.showWhen||{})).length&&(q=q[0],void 0!==(q=idToIndex[q])&&(groups[q]=groups[q]||[],groups[q].push(i))))}),new Set);for(let i=0;i<page.questions.length;i++)if(!appended.has(i))if(groups[i]){const childIndices=(groups[i]||[]).slice().sort((a,b)=>a-b);if(1==childIndices.length){var ci=childIndices[0];const groupDiv=document.createElement("div"),conditionalGroupMessageDiv=(groupDiv.className="conditional-group",groupDiv.appendChild(qwraps[i]),appended.add(i),appended.has(ci)||(groupDiv.appendChild(qwraps[ci]),appended.add(ci)),document.createElement("div"));conditionalGroupMessageDiv.className="conditional-group-message",conditionalGroupMessageDiv.dataset.parentQid=page.questions[i].id,groupDiv.appendChild(conditionalGroupMessageDiv),contentEl.appendChild(groupDiv)}else{const groupDiv=document.createElement("div"),conditionalGroupMessageDiv=(groupDiv.className="conditional-group",groupDiv.appendChild(qwraps[i]),appended.add(i),childIndices.forEach(ci=>{appended.has(ci)||(groupDiv.appendChild(qwraps[ci]),appended.add(ci))}),document.createElement("div"));conditionalGroupMessageDiv.className="conditional-group-message",conditionalGroupMessageDiv.dataset.parentQid=page.questions[i].id,groupDiv.appendChild(conditionalGroupMessageDiv),contentEl.appendChild(groupDiv)}}else{let isChild=!1;for(const pIdx in groups)if(groups[pIdx].includes(i)){isChild=!0;break}isChild||(contentEl.appendChild(qwraps[i]),appended.add(i))}const messagesSection=document.createElement("div"),nav=(messagesSection.className="page-messages",messagesSection.id="pageMessages",contentEl.appendChild(messagesSection),document.createElement("div")),back=(nav.className="nav-buttons",document.createElement("button")),next=(back.className="secondary",back.textContent="Previous page",document.createElement("button"));next.className="primary",next.textContent="Next page",back.disabled=0===pageIndex,back.addEventListener("click",()=>{var prev=Math.max(0,pageIndex-1);window.State.currentState.view="quiz",window.State.currentState.currentPage=prev,window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&quizBody.scrollIntoView({behavior:"smooth",block:"start"})},100)}),next.addEventListener("click",()=>{var nextPage=Math.min(quiz.pages.length-1,pageIndex+1);nextPage===pageIndex?window.State.currentState.view="results":(window.State.currentState.view="quiz",window.State.currentState.currentPage=nextPage),window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&quizBody.scrollIntoView({behavior:"smooth",block:"start"})},100)}),nav.appendChild(back),nav.appendChild(next),contentEl.appendChild(nav);var stateAnswers=window.State.currentState.answers||{};for(const qEl of contentEl.querySelectorAll(".question, .sub-question")){var qid=qEl.dataset.qid;const question=findQuestionInQuiz(quiz,qid);if(question){if("radio"===question.type){var val=stateAnswers[qid];if(val){const inp=qEl.querySelector(`input[type=radio][value="${val}"]`);inp&&(inp.checked=!0)}}else if("checkbox"===question.type){const val=stateAnswers[qid]||[];qEl.querySelectorAll("input[type=checkbox]").forEach(ch=>{ch.checked=val.includes(ch.value)})}else{const val=stateAnswers[qid],inp=qEl.querySelector("input");inp&&void 0!==val&&(inp.value=val)}val=function(){var sel;if("radio"===question.type)return(sel=qEl.querySelector("input[type=radio]:checked"))?sel.value:null;if("checkbox"!==question.type)return(sel=qEl.querySelector("input"))?sel.value:null;{const arr=[];return qEl.querySelectorAll("input[type=checkbox]:checked").forEach(c=>arr.push(c.value)),arr}}();showInlineMessageForQuestion(question,qEl,val),qEl.addEventListener("change",ev=>{const focusedInputId=ev.target?ev.target.id:null;!function(ev,quiz,pageIndex){const target=ev.target,questionEl=target.closest(".question, .sub-question");if(questionEl){var ev=questionEl.dataset.qid,question=findQuestionInQuiz(quiz,ev);if(question){const focusedInputId=target.id;let value;if("radio"===question.type){var sel=questionEl.querySelector("input[type=radio]:checked");value=sel?sel.value:null}else if("checkbox"===question.type){const arr=[];questionEl.querySelectorAll("input[type=checkbox]:checked").forEach(ch=>arr.push(ch.value)),value=arr}else{sel=questionEl.querySelector("input");value=sel?sel.value:null,"number"===question.type&&""!==value&&(value=Number(value))}if(window.State.currentState.answers||(window.State.currentState.answers={}),window.State.currentState.answers[ev]=value,window.State.currentState.currentPage=pageIndex,question.messageOnSelect){const msgDiv=questionEl.querySelector(".inline-message");let shown=!1;if("string"==typeof value&&question.messageOnSelect[value])msgDiv.textContent=question.messageOnSelect[value],msgDiv.style.display="block",shown=!0;else if(Array.isArray(value))for(const v of value)if(question.messageOnSelect[v]){msgDiv.textContent=question.messageOnSelect[v],msgDiv.style.display="block",shown=!0;break}shown||(msgDiv.style.display="none")}for(const other of document.querySelectorAll(".question, .sub-question")){var otherId=other.dataset.qid,q=findQuestionInQuiz(quiz,otherId);q&&(q=Conditional.isVisible(q,window.State.currentState.answers||{}),other.style.display=q?"":"none",q||delete window.State.currentState.answers[otherId])}updateConditionalGroupBorders(quiz),focusedInputId&&setTimeout(()=>{const inputToFocus=document.getElementById(focusedInputId);inputToFocus&&inputToFocus.focus()},0),window.State.saveStateToUrl(window.State.currentState,!0)}}}(ev,quiz,pageIndex);ev=function(){var sel;if("radio"===question.type)return(sel=qEl.querySelector("input[type=radio]:checked"))?sel.value:null;if("checkbox"!==question.type)return(sel=qEl.querySelector("input"))?sel.value:null;{const arr=[];return qEl.querySelectorAll("input[type=checkbox]:checked").forEach(c=>arr.push(c.value)),arr}}();showInlineMessageForQuestion(question,qEl,ev),updatePageMessages(quiz,page),updateInlineQuestionMessages(quiz,page),updateConditionalGroupMessages(quiz,page),focusedInputId&&setTimeout(()=>{const inputToFocus=document.getElementById(focusedInputId);inputToFocus&&inputToFocus.focus()},10)})}}function createQuestionElement(question,isSubQuestion=!1){const qwrap=document.createElement("div");if(qwrap.className=isSubQuestion?"sub-question":"question",qwrap.dataset.qid=question.id,question.helpText){const labelWrapper=document.createElement("div"),label=(labelWrapper.className="question-label-wrapper",document.createElement("label")),helpIcon=(label.textContent=question.label||question.id,document.createElement("button"));helpIcon.type="button",helpIcon.className="help-icon",helpIcon.textContent="i",helpIcon.setAttribute("data-bs-toggle","tooltip"),helpIcon.setAttribute("data-bs-placement","top"),helpIcon.setAttribute("data-bs-title",question.helpText),labelWrapper.appendChild(label),labelWrapper.appendChild(helpIcon),qwrap.appendChild(labelWrapper)}else{const label=document.createElement("label");label.textContent=question.label||question.id,qwrap.appendChild(label)}const optionsWrap=document.createElement("div");if(optionsWrap.className="options",void 0!==question.minScore&&(qwrap.dataset.minScore=question.minScore),Conditional.isVisible(question,window.State.currentState.answers||{})||(qwrap.style.display="none"),"radio"===question.type)question.options.forEach(opt=>{var isObj="object"==typeof opt&&null!==opt,optionLabel=isObj?opt.label||opt.value:String(opt),optionValue=isObj?opt.value||opt.label:String(opt),isObj=isObj&&void 0!==opt.score?Number(opt.score):"yes"===String(optionLabel).toLowerCase()?1:0,opt=(question.id+"__"+optionValue).replace(/\s+/g,"_");const div=document.createElement("div"),inp=document.createElement("input"),lab=(inp.type="radio",inp.name=question.id,inp.value=optionValue,inp.id=opt,inp.dataset.score=String(isObj),document.createElement("label"));lab.htmlFor=opt,lab.textContent=optionLabel,div.appendChild(inp),div.appendChild(lab),optionsWrap.appendChild(div)});else if("checkbox"===question.type)question.options.forEach(opt=>{var opt=String(opt),id=(question.id+"__"+opt).replace(/\s+/g,"_");const div=document.createElement("div"),inp=document.createElement("input"),lab=(inp.type="checkbox",inp.name=question.id,inp.value=opt,inp.id=id,document.createElement("label"));lab.htmlFor=id,lab.textContent=opt,div.appendChild(inp),div.appendChild(lab),optionsWrap.appendChild(div)});else if("number"===question.type||"text"===question.type){const inp=document.createElement("input");inp.type="number"===question.type?"number":"text",inp.name=question.id,inp.className="text-input",optionsWrap.appendChild(inp)}qwrap.appendChild(optionsWrap);const messageDiv=document.createElement("div"),questionMessageDiv=(messageDiv.className="inline-message",messageDiv.style.display="none",qwrap.appendChild(messageDiv),document.createElement("div"));return questionMessageDiv.className="question-message",questionMessageDiv.dataset.qid=question.id,qwrap.appendChild(questionMessageDiv),qwrap}updateConditionalGroupBorders(quiz),updatePageMessages(quiz,page),updateInlineQuestionMessages(quiz,page),updateConditionalGroupMessages(quiz,page),window.bootstrap&&window.bootstrap.Tooltip&&[...contentEl.querySelectorAll('[data-bs-toggle="tooltip"]')].map(tooltipTriggerEl=>new window.bootstrap.Tooltip(tooltipTriggerEl))}else contentEl.textContent="Quiz not found."},renderResults:async function(contentEl,quizId){document.getElementById("pageTitle").textContent="Results",contentEl.innerHTML="";const quiz=await window.JSONCache.get(getQuizUrl(quizId)),answers=window.State.currentState.answers||{},stepper=document.createElement("div"),resultsStep=(stepper.className="stepper",quiz.pages.forEach((p,idx)=>{const s=document.createElement("a"),t=(s.href="#",s.className="step",document.createElement("span"));t.textContent=p.title||"Page "+(idx+1),s.appendChild(t);var pageComplete=isPageCompleted(p,answers);let pageHasAnswers=!1;for(const q of p.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var a=answers[subQ.id];if(null!=a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}if(pageHasAnswers)break}else if(Conditional.isVisible(q,answers)){const a=answers[q.id];if(void 0!==a&&null!==a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}pageComplete?s.classList.add("completed"):pageHasAnswers&&s.classList.add("in-progress"),s.classList.add("completed"),s.addEventListener("click",e=>{e.preventDefault(),window.State.currentState.view="quiz",window.State.currentState.currentPage=idx,window.State.saveStateToUrl(window.State.currentState)}),stepper.appendChild(s)}),document.createElement("a")),resultsText=(resultsStep.href="#",resultsStep.className="step active",document.createElement("span"));resultsText.textContent="Your results",resultsStep.appendChild(resultsText),stepper.appendChild(resultsStep),contentEl.appendChild(stepper),window.dispatchEvent(new CustomEvent("stepperUpdated"));let totalScore=0,totalPossible=0;const pageScores=[];for(const page of quiz.pages){let pageScore=0,pagePossible=0;for(const q of page.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var maxScore;"radio"===subQ.type&&subQ.options&&(maxScore=Math.max(...subQ.options.map(opt=>"object"==typeof opt&&void 0!==opt.score?Number(opt.score):1)),pagePossible+=maxScore);let qScore=0;if("radio"===subQ.type){const val=answers[subQ.id];void 0===val||null===val||(maxScore=(subQ.options||[]).find(o=>"object"==typeof o?(o.value||o.label)==val||o.label==val:o==val))&&(qScore="object"==typeof maxScore&&void 0!==maxScore.score?Number(maxScore.score):"yes"===String(val).toLowerCase()?1:0)}pageScore+=qScore}}else if(Conditional.isVisible(q,answers)){if("radio"===q.type&&q.options){const maxScore=Math.max(...q.options.map(opt=>"object"==typeof opt&&void 0!==opt.score?Number(opt.score):1));pagePossible+=maxScore}else"checkbox"===q.type&&void 0!==q.minScore&&(pagePossible+=Number(q.minScore));let qScore=0;if("radio"===q.type){const val=answers[q.id];if(void 0!==val&&null!==val){const opt=(q.options||[]).find(o=>"object"==typeof o?(o.value||o.label)==val||o.label==val:o==val);opt&&(qScore="object"==typeof opt&&void 0!==opt.score?Number(opt.score):"yes"===String(val).toLowerCase()?1:0)}}else{var val;"checkbox"===q.type&&(val=answers[q.id]||[],val=Array.isArray(val)?val.length:0,void 0!==q.minScore&&q.minScore&&val>=Number(q.minScore)&&(qScore=Number(q.minScore)))}pageScore+=qScore}totalScore+=pageScore,totalPossible+=pagePossible,pageScores.push({title:page.title,score:pageScore,possible:pagePossible,percentage:0<pagePossible?Math.round(pageScore/pagePossible*100):0})}const overallCard=document.createElement("div"),overallTitle=(overallCard.className="quiz-results",document.createElement("h3")),healthScoreLabel=(overallTitle.textContent="Overall Health",overallCard.appendChild(overallTitle),document.createElement("div")),scoreCircle=(healthScoreLabel.classList.add("health-score-label"),healthScoreLabel.textContent="Health Score",overallCard.appendChild(healthScoreLabel),document.createElement("div")),overallPercentage=(scoreCircle.classList.add("score-circle"),0<totalPossible?Math.round(totalScore/totalPossible*100):0),percentText=(scoreCircle.style.setProperty("--score-percentage",""+overallPercentage),document.createElement("div")),strengthText=(percentText.textContent=overallPercentage+"%",percentText.classList.add("percent-text"),document.createElement("div")),appEl=(strengthText.textContent="Strengths",strengthText.classList.add("strength-text"),scoreCircle.appendChild(percentText),scoreCircle.appendChild(strengthText),overallCard.appendChild(scoreCircle),pageScores.forEach(ps=>{const scoreSection=document.createElement("div"),scoreTitle=(scoreSection.classList.add("page-score-section"),document.createElement("div")),progressBar=(scoreTitle.textContent=ps.title+" Score",scoreTitle.classList.add("page-score-title"),scoreSection.appendChild(scoreTitle),document.createElement("div")),progressFill=(progressBar.className="progress",document.createElement("i")),scoreValue=(progressFill.style.width=ps.percentage+"%",progressBar.appendChild(progressFill),scoreSection.appendChild(progressBar),document.createElement("div"));scoreValue.textContent=ps.score+"/"+ps.possible,scoreValue.classList.add("page-score-value"),scoreSection.appendChild(scoreValue),overallCard.appendChild(scoreSection)}),contentEl.appendChild(overallCard),document.getElementById("app"));var ans,isBusinessHealth=appEl&&"business-health-checklist"===appEl.dataset.quiz;if(isBusinessHealth){const paragraph=document.createElement("p");paragraph.innerHTML="Well done in completing this business health checklist to help you better understand your business and opportunities to improve.<br><br>Pick out a few key actions to work on at a time. Trying to change or improve everything at once will be difficult.<br><br>Would you like to speak to a Territory Business Advisor to speak about your results and make a plan of action?",contentEl.appendChild(paragraph)}const contactBtn=document.createElement("a");function handleContactModal(e){e.preventDefault();e=document.getElementById("floatingContact");if(e&&window.bootstrap&&window.bootstrap.Modal){const modal=new window.bootstrap.Modal(e);modal.show()}else window.location.href="https://business.nt.gov.au/contact"}contactBtn.href="#",contactBtn.className="btn btn-primary mb-4",contactBtn.textContent="Contact a Territory Business Advisor",contactBtn.addEventListener("click",handleContactModal);const territoryBtn=document.getElementById("territoryBusinessAdvisorModal"),aiSummarySection=(territoryBtn&&territoryBtn.addEventListener("click",handleContactModal),contentEl.appendChild(contactBtn),document.createElement("div")),recommendationsCard=(aiSummarySection.classList.add("ai-summary-section"),aiSummarySection.innerHTML='<div class="summary-loading"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div><span class="ms-2">Generating AI summary...</span></div>',overallCard.appendChild(aiSummarySection),(async()=>{if(window.AISummaryGenerator){window.AISummaryGenerator.initFromDataAttribute();var summary=await window.AISummaryGenerator.generateSummary({quizId:quizId,quizTitle:quiz.title||"Business Health Assessment",overallPercentage:overallPercentage,pageScores:pageScores,answers:answers,quiz:quiz});if(summary){aiSummarySection.innerHTML="";const summaryTitle=document.createElement("h4"),summaryContent=(summaryTitle.textContent=summary.title,summaryTitle.classList.add("summary-title"),document.createElement("p"));summaryContent.textContent=summary.content,summaryContent.classList.add("summary-content"),aiSummarySection.appendChild(summaryTitle),aiSummarySection.appendChild(summaryContent)}else aiSummarySection.remove()}else aiSummarySection.remove()})(),document.createElement("div")),recTitle=(recommendationsCard.className="quiz-recommendations",document.createElement("h3"));recTitle.textContent="Recommendations",recommendationsCard.appendChild(recTitle);let hasRecommendations=!1;for(const page of quiz.pages){const pageRecs={positive:[],recommendation:[]};for(const q of page.questions)if("group"===q.type&&q.subQuestions){let hasPositive=!1,hasNegative=!1;for(const subQ of q.subQuestions)Conditional.isVisible(subQ,answers)&&(ans=answers[subQ.id],"radio"===subQ.type&&("Yes"===ans&&(hasPositive=!0),"No"!==ans&&"Unsure"!==ans||(hasNegative=!0)));hasPositive&&q.positiveMessage&&pageRecs.positive.push(q.positiveMessage),hasNegative&&q.recommendation&&pageRecs.recommendation.push(q.recommendation);for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){const ans=answers[subQ.id];if("radio"===subQ.type){var isConditional=subQ.conditional&&subQ.conditional.showWhen;let parentQuestion=null;if(isConditional){const dependsOnId=Object.keys(subQ.conditional.showWhen)[0];parentQuestion=q.subQuestions.find(sq=>sq.id===dependsOnId)}(subQ.showRecommendationOnYes?"No"===ans:"Yes"===ans)&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupPositiveMessage?pageRecs.positive.some(m=>m.title===parentQuestion.conditionalQuestionGroupPositiveMessage.title)||pageRecs.positive.push(parentQuestion.conditionalQuestionGroupPositiveMessage):subQ.positiveMessage&&pageRecs.positive.push(subQ.positiveMessage));var shouldShowRec=subQ.showRecommendationOnYes?"Yes"===ans:"No"===ans||"Unsure"===ans;shouldShowRec&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupRecommendation?pageRecs.recommendation.some(m=>m.title===parentQuestion.conditionalQuestionGroupRecommendation.title)||pageRecs.recommendation.push(parentQuestion.conditionalQuestionGroupRecommendation):subQ.recommendation&&pageRecs.recommendation.push(subQ.recommendation))}}}else if(Conditional.isVisible(q,answers)){const ans=answers[q.id];if("radio"===q.type){const isConditional=q.conditional&&q.conditional.showWhen;let parentQuestion=null;if(isConditional){const dependsOnId=Object.keys(q.conditional.showWhen)[0];parentQuestion=page.questions.find(pq=>pq.id===dependsOnId)}const shouldShowPos=q.showRecommendationOnYes?"No"===ans:"Yes"===ans,shouldShowRec=(shouldShowPos&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupPositiveMessage?pageRecs.positive.some(m=>m.title===parentQuestion.conditionalQuestionGroupPositiveMessage.title)||pageRecs.positive.push(parentQuestion.conditionalQuestionGroupPositiveMessage):q.positiveMessage&&pageRecs.positive.push(q.positiveMessage)),q.showRecommendationOnYes?"Yes"===ans:"No"===ans||"Unsure"===ans);shouldShowRec&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupRecommendation?pageRecs.recommendation.some(m=>m.title===parentQuestion.conditionalQuestionGroupRecommendation.title)||pageRecs.recommendation.push(parentQuestion.conditionalQuestionGroupRecommendation):q.recommendation&&pageRecs.recommendation.push(q.recommendation))}}if(0<pageRecs.recommendation.length){hasRecommendations=!0;const pageSection=document.createElement("div"),pageHeading=(pageSection.className="page-recommendations",document.createElement("h4"));pageHeading.textContent=page.title,pageSection.appendChild(pageHeading),pageRecs.recommendation.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item recommendation",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),pageSection.appendChild(msgDiv)}),recommendationsCard.appendChild(pageSection)}}hasRecommendations&&contentEl.appendChild(recommendationsCard);const actionsWrap=document.createElement("div"),copyBtn=(actionsWrap.classList.add("results-actions"),document.createElement("button")),printBtn=(copyBtn.className="secondary",copyBtn.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-link"></i><span>Copy link to this report</span>'),document.createElement("button")),pdfBtn=(printBtn.className="secondary",printBtn.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-print"></i><span>Print results</span>'),document.createElement("button"));if(pdfBtn.className="primary",pdfBtn.textContent="Download report",pdfBtn.addEventListener("click",async()=>{var element;if(window.jspdf)try{const jsPDF=window.jspdf["jsPDF"],pdf=new jsPDF({orientation:"portrait",unit:"mm",format:"a4"}),pageWidth=pdf.internal.pageSize.getWidth(),pageHeight=pdf.internal.pageSize.getHeight(),margin=15,contentWidth=pageWidth-2*margin;let yPosition=margin;var appEl=document.getElementById("app");const checkPageBreak=heightNeeded=>yPosition+heightNeeded>pageHeight-margin-10&&(pdf.addPage(),yPosition=margin,!0),addText=(text,fontSize,fontWeight="normal",color=[0,0,0],leftMargin=0)=>{pdf.setFontSize(fontSize);let fontStyle="bold"!==fontWeight&&700!==fontWeight?"normal":"bold";pdf.setFont("helvetica",fontStyle),pdf.setTextColor(...color);const lines=pdf.splitTextToSize(text,contentWidth-leftMargin),lineHeight=.4*fontSize;return checkPageBreak(lines.length*lineHeight),lines.forEach(line=>{pdf.text(line,margin+leftMargin,yPosition),yPosition+=lineHeight}),lines.length*lineHeight},businessLogoUrl=appEl?appEl.dataset.businessLogo:null;if(businessLogoUrl)try{const businessLogoImg=new Image;businessLogoImg.crossOrigin="anonymous",await new Promise((resolve,reject)=>{businessLogoImg.onload=()=>{try{const canvas=document.createElement("canvas"),ctx=(canvas.width=businessLogoImg.width,canvas.height=businessLogoImg.height,canvas.getContext("2d"));ctx.drawImage(businessLogoImg,0,0);var logoDataUrl=canvas.toDataURL("image/png"),logoHeight=businessLogoImg.height/businessLogoImg.width*50;pdf.addImage(logoDataUrl,"PNG",margin,yPosition,50,logoHeight),yPosition+=10+logoHeight,resolve()}catch(err){console.error("Error adding business logo:",err),resolve()}},businessLogoImg.onerror=()=>{console.error("Failed to load business logo"),resolve()},businessLogoImg.src=businessLogoUrl.startsWith("/")?window.location.origin+businessLogoUrl:businessLogoUrl})}catch(e){console.error("Business logo loading error:",e)}yPosition+=5,addText(quiz.title||"Business Health Report",22,500,[0,0,0]),yPosition+=5;const contentEl=document.getElementById("quizContent");var scoreCircleImage,scoreCircle=contentEl.querySelector(".score-circle");scoreCircle&&(element=scoreCircle,scoreCircleImage=await new Promise(resolve=>{const canvas=document.createElement("canvas");var rect=element.getBoundingClientRect();canvas.width=3*rect.width,canvas.height=3*rect.height;const ctx=canvas.getContext("2d");ctx.scale(3,3);var styles=window.getComputedStyle(element),bgColor=styles.backgroundColor,styles=styles.color,bgColor=(ctx.fillStyle=bgColor||"#0093b8",ctx.beginPath(),ctx.arc(rect.width/2,rect.height/2,rect.width/2,0,2*Math.PI),ctx.fill(),ctx.fillStyle="#ffffff",ctx.beginPath(),ctx.arc(rect.width/2,rect.height/2,rect.width/2-16,0,2*Math.PI),ctx.fill(),element.querySelector(".percent-text")),strengthText=element.querySelector(".strength-text");ctx.textAlign="center",ctx.fillStyle=styles||"#000000",bgColor&&(ctx.font="bold 32px Helvetica",ctx.fillText(bgColor.textContent,rect.width/2,rect.height/2-5)),strengthText&&(ctx.font="14px Helvetica",ctx.fillText(strengthText.textContent,rect.width/2,rect.height/2+20)),resolve(canvas.toDataURL("image/png"))}),addText("Overall Health",18,500,[0,0,0]),yPosition+=2,pdf.setFontSize(9),pdf.setFont("helvetica","bold"),pdf.text("Health Score",margin,yPosition),yPosition+=5,checkPageBreak(45),pdf.addImage(scoreCircleImage,"PNG",margin,yPosition,40,40),yPosition+=50);const resultsHeader=contentEl.querySelector("h2"),resultsCards=(resultsHeader&&!resultsHeader.textContent.includes("Overall Health")&&(addText(resultsHeader.textContent.trim(),18,500,[0,0,0]),yPosition+=3),contentEl.querySelectorAll(".results-card, .result-item")),allElements=(resultsCards.forEach(card=>{checkPageBreak(20);const title=card.querySelector("h3, h4, .card-title, strong"),description=(title&&(addText(title.textContent.trim(),14,500,[0,70,130]),yPosition+=2),card.querySelector("p, .card-text, .description"));description&&(addText(description.textContent.trim(),10,"normal",[43,41,45]),yPosition+=4)}),contentEl.querySelectorAll("h1, h2, h3, h4, h5, h6, p, ul, ol, .alert, .card-body, .message-body, .message-item")),aiSummary=(allElements.forEach(el=>{if(!(el.closest(".results-actions")||el.closest(".stepper")||el.closest(".quiz-nav-buttons")||el.closest(".btn-primary")||el.closest(".ai-summary-section")||el.closest(".discover-more-section"))&&(!el.closest(".quiz-recommendations")||el.classList.contains("message-body")||el.classList.contains("message-item"))&&(!el.classList.contains("message-body")||!el.closest(".message-item"))){const tagName=el.tagName.toLowerCase();var text=el.textContent.trim();if(text)if(el.classList.contains("message-item")){checkPageBreak(15);const titleEl=el.querySelector(".message-title"),bodyEl=el.querySelector(".message-body");if(titleEl&&titleEl.textContent.trim()&&(addText(titleEl.textContent.trim(),12,"bold",[0,70,130]),yPosition+=2),bodyEl){const fontSize=10,lineHeight=.4*fontSize,paragraphs=bodyEl.querySelectorAll("p");if(0<paragraphs.length)paragraphs.forEach((pEl,pIndex)=>{const tempDiv=document.createElement("div");tempDiv.innerHTML=pEl.innerHTML;let currentX=margin;const processNode=node=>{if(node.nodeType===Node.TEXT_NODE){var textContent=node.textContent.trim();if(textContent){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(43,41,45);const words=pdf.splitTextToSize(textContent,contentWidth-(currentX-margin));words.forEach(word=>{currentX+pdf.getTextWidth(word)>pageWidth-margin&&(yPosition+=lineHeight,currentX=margin,checkPageBreak(lineHeight)),pdf.text(word,currentX,yPosition),currentX+=pdf.getTextWidth(word)+pdf.getTextWidth(" ")})}}else if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.tagName){textContent=node.textContent.trim();const href=node.getAttribute("href");if(textContent&&href){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(0,123,255);const words=pdf.splitTextToSize(textContent,contentWidth-(currentX-margin));words.forEach(word=>{currentX+pdf.getTextWidth(word)>pageWidth-margin&&(yPosition+=lineHeight,currentX=margin,checkPageBreak(lineHeight)),pdf.text(word,currentX,yPosition);var word=pdf.getTextWidth(word),textHeight=.4*fontSize;pdf.link(currentX,yPosition-textHeight+2,word,textHeight,{url:href}),currentX+=word+pdf.getTextWidth(" "),pdf.setDrawColor(0,123,255),pdf.line(currentX-word-pdf.getTextWidth(" "),yPosition+1,currentX-pdf.getTextWidth(" "),yPosition+1)})}}else if(node.nodeType===Node.ELEMENT_NODE){const children=Array.from(node.childNodes);children.forEach(processNode)}},childNodes=Array.from(tempDiv.childNodes);childNodes.forEach(processNode),yPosition+=lineHeight+3});else{const tempDiv=document.createElement("div");tempDiv.innerHTML=bodyEl.innerHTML;let currentX=margin;const processNode=node=>{if(node.nodeType===Node.TEXT_NODE){var textContent=node.textContent.trim();if(textContent){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(43,41,45);const words=pdf.splitTextToSize(textContent,contentWidth-(currentX-margin));words.forEach(word=>{currentX+pdf.getTextWidth(word)>pageWidth-margin&&(yPosition+=lineHeight,currentX=margin,checkPageBreak(lineHeight)),pdf.text(word,currentX,yPosition),currentX+=pdf.getTextWidth(word)+pdf.getTextWidth(" ")})}}else if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.tagName){textContent=node.textContent.trim();const href=node.getAttribute("href");if(textContent&&href){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(0,123,255);const words=pdf.splitTextToSize(textContent,contentWidth-(currentX-margin));words.forEach(word=>{currentX+pdf.getTextWidth(word)>pageWidth-margin&&(yPosition+=lineHeight,currentX=margin,checkPageBreak(lineHeight)),pdf.text(word,currentX,yPosition);var word=pdf.getTextWidth(word),textHeight=.4*fontSize;pdf.link(currentX,yPosition-textHeight+2,word,textHeight,{url:href}),currentX+=word+pdf.getTextWidth(" "),pdf.setDrawColor(0,123,255),pdf.line(currentX-word-pdf.getTextWidth(" "),yPosition+1,currentX-pdf.getTextWidth(" "),yPosition+1)})}}else if(node.nodeType===Node.ELEMENT_NODE){const children=Array.from(node.childNodes);children.forEach(processNode)}},childNodes=Array.from(tempDiv.childNodes);childNodes.forEach(processNode),yPosition+=lineHeight+3}}}else{if(el.classList.contains("message-body")){const tempDiv=document.createElement("div");tempDiv.innerHTML=el.innerHTML;let currentX=margin;const fontSize=10,lineHeight=.4*fontSize,processNode=(checkPageBreak(15),node=>{if(node.nodeType===Node.TEXT_NODE){var textContent=node.textContent.trim();if(textContent){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(43,41,45);const words=pdf.splitTextToSize(textContent,contentWidth-(currentX-margin));words.forEach(word=>{currentX+pdf.getTextWidth(word)>pageWidth-margin&&(yPosition+=lineHeight,currentX=margin,checkPageBreak(lineHeight)),pdf.text(word,currentX,yPosition),currentX+=pdf.getTextWidth(word)+pdf.getTextWidth(" ")})}}else if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.tagName){textContent=node.textContent.trim();const href=node.getAttribute("href");if(textContent&&href){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(0,123,255);const words=pdf.splitTextToSize(textContent,contentWidth-(currentX-margin));words.forEach((word,index)=>{currentX+pdf.getTextWidth(word)>pageWidth-margin&&(yPosition+=lineHeight,currentX=margin,checkPageBreak(lineHeight)),pdf.text(word,currentX,yPosition);var word=pdf.getTextWidth(word),textHeight=.4*fontSize;pdf.link(currentX,yPosition-textHeight+2,word,textHeight,{url:href}),currentX+=word+pdf.getTextWidth(" "),pdf.setDrawColor(0,123,255),pdf.line(currentX-word-pdf.getTextWidth(" "),yPosition+1,currentX-pdf.getTextWidth(" "),yPosition+1)})}}else if(node.nodeType===Node.ELEMENT_NODE){const children=Array.from(node.childNodes);children.forEach(processNode)}}),childNodes=Array.from(tempDiv.childNodes);return childNodes.forEach(processNode),void(yPosition+=lineHeight+3)}if(tagName.startsWith("h")){var fontSize={1:22,2:18,3:16,4:14,5:12,6:11}[parseInt(tagName.charAt(1))]||12;checkPageBreak(10),yPosition+=3,addText(text,fontSize,500,[0,0,0]),yPosition+=2}else if("ul"===tagName||"ol"===tagName){const items=el.querySelectorAll("li");items.forEach((li,index)=>{index="ul"===tagName?"-":index+1+".";if(checkPageBreak(8),pdf.setFontSize(10),pdf.setTextColor(43,41,45),pdf.text(index,margin,yPosition),li.innerHTML!==li.textContent){const tempDiv=document.createElement("div");tempDiv.innerHTML=li.innerHTML;let currentX=margin+8;const fontSize=10,lineHeight=.4*fontSize,processNode=node=>{if(node.nodeType===Node.TEXT_NODE){var textContent=node.textContent.trim();if(textContent){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(43,41,45);const lines=pdf.splitTextToSize(textContent,contentWidth-8);checkPageBreak(lines.length*lineHeight),lines.forEach((line,lineIndex)=>{0<lineIndex&&(yPosition+=lineHeight,currentX=margin+8),pdf.text(line,currentX,yPosition),currentX+=pdf.getTextWidth(line)})}}else if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.tagName){textContent=node.textContent.trim();const href=node.getAttribute("href");if(textContent&&href){pdf.setFontSize(fontSize),pdf.setFont("helvetica","normal"),pdf.setTextColor(0,123,255);const lines=pdf.splitTextToSize(textContent,contentWidth-8);checkPageBreak(lines.length*lineHeight),lines.forEach((line,lineIndex)=>{0<lineIndex&&(yPosition+=lineHeight,currentX=margin+8),pdf.text(line,currentX,yPosition);lineIndex=pdf.getTextWidth(line),line=.4*fontSize;pdf.link(currentX,yPosition-line+2,lineIndex,line,{url:href}),currentX+=lineIndex,pdf.setDrawColor(0,123,255),pdf.line(currentX-lineIndex,yPosition+1,currentX,yPosition+1)})}}else if(node.nodeType===Node.ELEMENT_NODE){const children=Array.from(node.childNodes);children.forEach(processNode)}},childNodes=Array.from(tempDiv.childNodes);childNodes.forEach(processNode),yPosition+=lineHeight}else addText(li.textContent.trim(),10,"normal",[43,41,45],8)}),yPosition+=2}else el.classList.contains("alert")?(checkPageBreak(15),pdf.setFillColor(240,240,240),pdf.rect(margin,yPosition-3,contentWidth,10,"F"),addText(text,10,"normal",[100,100,0]),yPosition+=3):"p"!==tagName||el.closest(".results-card")||(checkPageBreak(10),addText(text,10,"normal",[43,41,45]),yPosition+=5)}}}),contentEl.querySelector(".ai-summary-section"));if(aiSummary&&!aiSummary.querySelector(".summary-loading")){checkPageBreak(20),yPosition+=5;const summaryTitle=aiSummary.querySelector("h3, h4"),summaryText=(summaryTitle&&(addText(summaryTitle.textContent.trim(),16,500,[0,100,0]),yPosition+=2),aiSummary.querySelector(".summary-content, p"));summaryText&&(addText(summaryText.textContent.trim(),10,"normal",[43,41,45]),yPosition+=5)}yPosition+=10,checkPageBreak(20),pdf.setDrawColor(222,226,230),pdf.line(margin,yPosition,pageWidth-margin,yPosition),yPosition+=5;const logoUrl=appEl?appEl.dataset.ntgLogo:null;if(logoUrl)try{const logoImg=new Image;logoImg.crossOrigin="anonymous",await new Promise((resolve,reject)=>{logoImg.onload=()=>{try{const canvas=document.createElement("canvas"),ctx=(canvas.width=logoImg.width,canvas.height=logoImg.height,canvas.getContext("2d"));ctx.drawImage(logoImg,0,0);var logoDataUrl=canvas.toDataURL("image/png"),logoHeight=logoImg.height/logoImg.width*40;pdf.addImage(logoDataUrl,"PNG",margin,yPosition,40,logoHeight),yPosition+=5+logoHeight,resolve()}catch(err){console.error("Error adding logo:",err),resolve()}},logoImg.onerror=()=>{console.error("Failed to load logo"),resolve()},logoImg.src=logoUrl.startsWith("/")?window.location.origin+logoUrl:logoUrl})}catch(e){console.error("Logo loading error:",e)}pdf.setFontSize(8),pdf.setFont("helvetica","bold"),pdf.setTextColor(43,41,45),pdf.text("Disclaimer:",margin,yPosition),yPosition+=4;addText("Laws and regulations can change over time. While we aim to provide accurate guidance and point you to helpful resources, it's important that you check whether the information is suitable for your specific situation. Every business is different, so please make sure any advice or material you use is right for your circumstances before making decisions or taking action.",8,"normal",[100,100,100]);var totalPages=pdf.internal.getNumberOfPages();for(let i=1;i<=totalPages;i++)pdf.setPage(i),pdf.setFontSize(9),pdf.setTextColor(128),pdf.text(`Page ${i} of `+totalPages,pageWidth/2,pageHeight-8,{align:"center"});pdf.save(`${quiz.title||"report"}.pdf`)}catch(error){console.error("Error generating PDF:",error),alert("Error generating PDF. Please try again.")}else alert("jsPDF not loaded")}),copyBtn.addEventListener("click",async()=>{try{var encoded=window.State.encodeState(window.State.currentState),link=window.location.origin+window.location.pathname+"#?state="+encoded;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(link),alert("Link copied to clipboard");else{const ta=document.createElement("textarea");ta.value=link,document.body.appendChild(ta),ta.select(),document.execCommand("copy"),document.body.removeChild(ta),alert("Link copied to clipboard")}}catch(e){alert("Copy failed: "+e.message)}}),printBtn.addEventListener("click",()=>{const contentEl=document.getElementById("quizContent"),clone=contentEl.cloneNode(!0),actionsWrap=clone.querySelector(".results-actions"),stepper=(actionsWrap&&actionsWrap.querySelector("button")&&actionsWrap.remove(),clone.querySelector(".stepper")),navButtons=(stepper&&stepper.remove(),clone.querySelector(".quiz-nav-buttons")),contactButton=(navButtons&&navButtons.remove(),clone.querySelector(".btn.btn-primary.mb-4")),aiSummary=(contactButton&&contactButton.remove(),clone.querySelector(".ai-summary-section")),titleElement=(aiSummary&&aiSummary.querySelector(".summary-loading")&&aiSummary.remove(),document.createElement("h1")),printFooter=(titleElement.textContent=quiz.title||"Business Health Report",titleElement.style.fontSize="24px",titleElement.style.fontWeight="700",titleElement.style.marginBottom="20px",clone.insertBefore(titleElement,clone.firstChild),document.createElement("div"));printFooter.className="row mt-5 pt-4 gy-2",printFooter.style.borderTop="1px solid #dee2e6";var appEl=document.getElementById("app"),appEl=appEl?appEl.dataset.ntgLogo:"/assets/css-images/logo-ntg-color.svg";printFooter.innerHTML=`
                <div class="col-12">
                    <img src="${appEl}" alt="Northern Territory Government" style="max-width: 150px; height: auto;">
                </div>
                <div class="col-12">
                    <p>
                        <strong>Disclaimer:</strong> Laws and regulations can change over time. While we aim to provide accurate guidance and point you to helpful resources, it's important that you check whether the information is suitable for your specific situation. Every business is different, so please make sure any advice or material you use is right for your circumstances before making decisions or taking action.
                    </p>
                </div>
            `,clone.appendChild(printFooter);const newWin=window.open("","_blank");newWin?(appEl=`<!doctype html><html><head><meta charset="utf-8">${Array.from(document.querySelectorAll("link[rel=stylesheet]")).map(l=>`<link rel="stylesheet" href="${l.href}">`).join("\n")}${Array.from(document.querySelectorAll("style")).map(s=>`<style>${s.innerHTML}</style>`).join("\n")}
                <style>
                    @media print {
                        body { margin: 0; padding: 20px; }
                        * { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
                        
                        @page {
                            margin: 20mm 15mm;
                            @bottom-center {
                                content: "Page " counter(page) " of " counter(pages);
                                font-size: 9pt;
                                color: #808080;
                            }
                        }
                        
                        /* Fallback for browsers that don't support @page margin boxes */
                        body::after {
                            content: "";
                            display: block;
                            height: 50px;
                        }
                    }
                </style>
            <title>Print - ${quiz.title}</title></head><body><div class="ntg-quiz-body">${clone.innerHTML}</div></body></html>`,newWin.document.open(),newWin.document.write(appEl),newWin.document.close(),newWin.focus(),setTimeout(()=>{newWin.print()},1e3)):alert("Unable to open print window")}),actionsWrap.appendChild(copyBtn),actionsWrap.appendChild(printBtn),actionsWrap.appendChild(pdfBtn),isBusinessHealth){const paragraph=document.createElement("div");paragraph.className="discover-more-section",paragraph.innerHTML='<h3>Discover more</h3><ul><li>Learn about <a href="https://business.nt.gov.au/help-for-business/applying-for-business-funding-and-grants" target="_blank">applying for business funding and grants</a></li><li>Find <a href="https://business.nt.gov.au/help-for-business/business-tools-and-learning/mental-health-in-the-workplace" target="_blank">mental health and wellbeing resources for businesses</a></li><li>Subscribe to the <a href="https://web.businesscrm.nt.gov.au/cn/awlvn/industry_det" target="_blank">NT Business Bulletin</a> for ongoing updates for businesses in the NT</li></li><li>Find current <a href="https://business.nt.gov.au/about-nt-business/events-and-business-awards" target="_blank">business events and awards</a> </li></ul>',contentEl.appendChild(paragraph)}document.getElementById("pageTitle").appendChild(actionsWrap);try{const appEl=document.getElementById("app");var navUrl=appEl?appEl.dataset.quizMainNavigation:"../assets/data/mainNavigation.json";const nav=await window.JSONCache.get(navUrl),idx=nav.quizzes.findIndex(q=>q.id===quizId),navWrap=document.createElement("div"),prevBtn=(navWrap.className="quiz-nav-buttons",document.createElement("button")),nextBtn=(prevBtn.className="secondary",document.createElement("button"));nextBtn.className="secondary",0<idx?prevBtn.textContent=nav.quizzes[idx-1].title:(prevBtn.textContent="Previous Quiz",prevBtn.disabled=!0),-1!==idx&&idx<nav.quizzes.length-1?nextBtn.textContent=nav.quizzes[idx+1].title:(nextBtn.textContent="Next Quiz",nextBtn.disabled=!0),prevBtn.addEventListener("click",()=>{var prevId;0<idx&&(prevId=nav.quizzes[idx-1].id,window.State.currentState.view="quiz",window.State.currentState.quizId=prevId,window.State.currentState.currentPage=0,window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&(console.log("Scrolling"),quizBody.scrollIntoView({behavior:"smooth",block:"start"}))},100))}),nextBtn.addEventListener("click",()=>{var nextId;idx<nav.quizzes.length-1&&(nextId=nav.quizzes[idx+1].id,window.State.currentState.view="quiz",window.State.currentState.quizId=nextId,window.State.currentState.currentPage=0,window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{console.log("Scrolling");const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&quizBody.scrollIntoView({behavior:"smooth",block:"start"})},100))}),navWrap.appendChild(prevBtn),navWrap.appendChild(nextBtn),contentEl.appendChild(navWrap)}catch(e){}}}}(),function(global){function getQuizUrl(quizId){var appEl=document.getElementById("app");return appEl?"business-health-checklist"===appEl.dataset.quiz?appEl.dataset[quizId.toLowerCase()]?appEl.dataset[quizId.toLowerCase()]:`../assets/business-health-checklist-quiz/quizzes/${quizId}.json`:appEl.dataset[quizId]||`../assets/data/quizzes/${quizId}.json`:`../assets/data/quizzes/${quizId}.json`}async function route(){var content=document.getElementById("quizContent");if(void 0===window.UI)setTimeout(route,50);else{var appEl=document.getElementById("app"),navUrl=appEl?appEl.dataset.quizMainNavigation:"../assets/data/mainNavigation.json",navUrl=await window.JSONCache.get(navUrl),appEl=appEl?appEl.dataset.uiMessages:"../assets/data/uiMessages.json",appEl=await window.JSONCache.get(appEl),view=window.State&&window.State.currentState&&window.State.currentState.view||"start";if("start"===view)window.State.currentState={view:"start",quizId:null,currentPage:0,answers:{}},window.UI.renderStart(content,appEl);else if("choose-topic"===view)window.UI.renderChooseTopic(content,navUrl);else if("quiz"===view){var navUrl=window.State&&window.State.currentState&&window.State.currentState.quizId||null,pageIndex=window.State&&window.State.currentState&&window.State.currentState.currentPage||0;navUrl?await window.UI.renderQuizPage(content,navUrl,pageIndex):(window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState))}else if("results"===view){const quizId=window.State&&window.State.currentState&&window.State.currentState.quizId||null;quizId?await window.UI.renderResults(content,quizId):(window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState))}else window.State.currentState.view="start",window.UI.renderStart(content,appEl);!async function(){const appEl=document.getElementById("app"),navUrl=appEl?appEl.dataset.quizMainNavigation:"../assets/data/mainNavigation.json",nav=await window.JSONCache.get(navUrl),ul=document.getElementById("quizList"),sideLinks=(ul.innerHTML="",document.getElementById("sideLinks")),btnStart=(sideLinks.innerHTML="",document.createElement("button")),btnChoose=(btnStart.textContent="Get Started",document.createElement("button")),currentView=(btnChoose.textContent="Choose a Topic",window.State&&window.State.currentState&&window.State.currentState.view||"start");"start"===currentView&&btnStart.classList.add("active");"choose-topic"===currentView&&btnChoose.classList.add("active");btnStart.addEventListener("click",()=>{window.State.currentState.view="start",window.State.saveStateToUrl(window.State.currentState)}),btnChoose.addEventListener("click",()=>{window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState)}),sideLinks.appendChild(btnStart),sideLinks.appendChild(btnChoose);var activeQuizId=window.State&&window.State.currentState&&window.State.currentState.quizId||null;for(const q of nav.quizzes){const li=document.createElement("li"),meta=document.createElement("div"),titleLink=(meta.className="quizMeta",document.createElement("a")),prog=(titleLink.className="quizTitle",titleLink.textContent=q.title,titleLink.href="#",titleLink.addEventListener("click",e=>{e.preventDefault(),window.State&&(window.State.currentState.view="quiz",window.State.currentState.quizId=q.id,window.State.currentState.currentPage=0,window.State.currentState.answers||(window.State.currentState.answers={}),window.State.saveStateToUrl(window.State.currentState))}),document.createElement("div"));if(prog.className="quizProgress",prog.textContent="0%",meta.appendChild(titleLink),li.appendChild(meta),li.appendChild(prog),activeQuizId===q.id&&li.classList.add("active"),(async()=>{await window.UI&&window.UI.renderChooseTopic;var percent=await(async()=>{try{var ans,quiz=await window.JSONCache.get(getQuizUrl(q.id)),answers=window.State&&window.State.currentState&&window.State.currentState.answers||{};let total=0,answered=0;for(const page of quiz.pages)for(const question of page.questions)if("group"===question.type&&question.subQuestions)for(const subQ of question.subQuestions)window.Conditional.isVisible(subQ,answers,quiz)&&(total++,null!=(ans=answers[subQ.id])&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++);else if(window.Conditional.isVisible(question,answers,quiz)){total++;const ans=answers[question.id];void 0!==ans&&null!==ans&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++}return total?Math.round(answered/total*100):0}catch(e){return 0}})(),isComplete=100===percent;prog.innerHTML=percent+"% "+(isComplete?'<i class="fa-solid fa-circle-check"></i>':'<i class="fa-regular fa-circle"></i>')})(),ul.appendChild(li),activeQuizId===q.id)try{const quiz=await window.JSONCache.get(getQuizUrl(q.id)),pagesList=document.createElement("ol"),answers=(pagesList.className="quiz-pages-list",window.State.currentState&&window.State.currentState.answers||{}),currentPage=window.State.currentState&&window.State.currentState.currentPage||0,liResults=(quiz.pages.forEach((p,idx)=>{const li2=document.createElement("li"),pageLink=(li2.className="page-item",document.createElement("a"));pageLink.href="#",pageLink.textContent=p.title||"Page "+(idx+1),pageLink.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),window.State.currentState.view="quiz",window.State.currentState.currentPage=idx,window.State.saveStateToUrl(window.State.currentState)}),li2.appendChild(pageLink),"quiz"===currentView&&idx===currentPage&&li2.classList.add("active");let pageComplete=!0,pageHasAnswers=!1;for(const qst of p.questions)if("group"===qst.type&&qst.subQuestions)for(const subQ of qst.subQuestions){var ans;window.Conditional.isVisible(subQ,answers,quiz)&&(null!=(ans=answers[subQ.id])&&""!==ans?(Array.isArray(ans)&&0<ans.length||!Array.isArray(ans))&&(pageHasAnswers=!0):pageComplete=!1)}else if(window.Conditional.isVisible(qst,answers,quiz)){const ans=answers[qst.id];void 0!==ans&&null!==ans&&""!==ans?(Array.isArray(ans)&&0<ans.length||!Array.isArray(ans))&&(pageHasAnswers=!0):pageComplete=!1}pageComplete&&pageHasAnswers?li2.classList.add("completed"):pageHasAnswers&&li2.classList.add("in-progress"),pagesList.appendChild(li2)}),document.createElement("li")),resultsLink=(liResults.className="page-item results-item",document.createElement("a"));resultsLink.href="#",resultsLink.textContent="Your results",resultsLink.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),window.State.currentState.view="results",window.State.saveStateToUrl(window.State.currentState)}),liResults.appendChild(resultsLink),"results"===currentView&&liResults.classList.add("active"),pagesList.appendChild(liResults),ul.appendChild(pagesList)}catch(e){}}}()}}window.addEventListener("hashchange",route),global.Router={route:route}}(window),async function(){document.addEventListener("DOMContentLoaded",async function(){if(document.querySelector("#app.ntg-quiz")){try{await window.JSONCache.init()}catch(error){console.error("Failed to initialize quiz cache:",error)}Modal.init();var existing=State.loadStateFromUrl();existing&&(State.currentState=existing,Modal.show(),document.addEventListener("modal:resume",()=>{Router.route(),setTimeout(()=>{document.body.setAttribute("tabindex","-1"),document.body.focus(),document.body.removeAttribute("tabindex")},100)},{once:!0}),document.addEventListener("modal:fresh",()=>{Modal.hide(),State.clearState(),State.currentState={view:"start",quizId:null,currentPage:0,answers:{}},State.saveStateToUrl(State.currentState),Router.route()},{once:!0})),Router.route()}})}(),window,initMegaMenu(),initResponsiveMenu(),initMmenu(),initSuperfish(),initStickyHeader(),initSideNav(),initScrollToTop(),initResponsiveTable(),initSameHeight(),initFlickity(),initCountUp(),initResponsivePagination(),initLinkCheck(),initAddHoverClassOnCardHover(),initVideoControl(),initQuizUI();