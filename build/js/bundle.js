function fadeOut(el){el.style.opacity=1,function fade(){(el.style.opacity-=.1)<=0?el.style.display="none":requestAnimationFrame(fade)}()}function fadeIn(el,display){el.style.opacity=0,el.style.display=display||"block",function fade(){var val=parseFloat(el.style.opacity);1<(val+=.1)||(el.style.opacity=val,requestAnimationFrame(fade))}()}!function(global){global.JSONCache=new class{constructor(){this.cache=new Map,this.loading=new Map,this.loadingOverlay=null}async init(){this.showLoadingOverlay("Loading quiz data...");try{var appEl=document.getElementById("app");if(!appEl)throw new Error("App element not found");var urls={mainNavigation:appEl.dataset.quizMainNavigation||"../assets/data/mainNavigation.json",uiMessages:appEl.dataset.uiMessages||"../assets/data/uiMessages.json",propertySafety:appEl.dataset.propertySafety,staffSafety:appEl.dataset.staffSafety,mobileBusiness:appEl.dataset.mobileBusiness,vehicleSafety:appEl.dataset.vehicleSafety},fetchPromises=Object.entries(urls).filter(([,url])=>url).map(([key,url])=>this.fetchWithCache(url).then(data=>({key:key,url:url,data:data}))),results=await Promise.all(fetchPromises);return this.hideLoadingOverlay(),results}catch(error){throw this.hideLoadingOverlay(),this.showError("Failed to load quiz data. Please refresh the page."),error}}async fetchWithCache(url){if(this.loading.has(url))return this.loading.get(url);var cached=this.cache.get(url);if(cached)return this.validateCache(url,cached),cached.data;cached=this.fetchJSON(url);this.loading.set(url,cached);try{var result=await cached;return this.loading.delete(url),result}catch(error){throw this.loading.delete(url),error}}async fetchJSON(url){const response=await fetch(url);if(!response.ok)throw new Error(`Failed to fetch ${url}: `+response.statusText);var data=await response.json(),etag=response.headers.get("ETag"),lastModified=response.headers.get("Last-Modified");return this.cache.set(url,{data:data,etag:etag,lastModified:lastModified,timestamp:Date.now()}),data}async validateCache(url,cached){try{const response=await fetch(url,{method:"HEAD"});var etag=response.headers.get("ETag"),lastModified=response.headers.get("Last-Modified");(etag&&etag!==cached.etag||lastModified&&lastModified!==cached.lastModified)&&(this.cache.delete(url),await this.fetchJSON(url))}catch(error){console.warn("Cache validation failed:",error)}}async get(url){return this.fetchWithCache(url)}clear(){this.cache.clear(),this.loading.clear()}showLoadingOverlay(message="Loading..."){this.loadingOverlay||(this.loadingOverlay=document.createElement("div"),this.loadingOverlay.className="quiz-loading-overlay",this.loadingOverlay.innerHTML=`
                <div class="quiz-loading-content">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">${message}</p>
                </div>
            `,document.body.appendChild(this.loadingOverlay))}hideLoadingOverlay(){this.loadingOverlay&&(this.loadingOverlay.remove(),this.loadingOverlay=null)}showError(message){const errorDiv=document.createElement("div");errorDiv.className="alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3",errorDiv.style.zIndex="9999",errorDiv.innerHTML=`
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `,document.body.appendChild(errorDiv),setTimeout(()=>{errorDiv.remove()},5e3)}}}(window);var LZString={compressToEncodedURIComponent:function(input){if(null==input)return"";try{var encoded=unescape(encodeURIComponent(input)),b64=btoa(encoded);return encodeURIComponent(b64)}catch(e){return console.warn("LZString fallback compress failed",e),encodeURIComponent(input)}},decompressFromEncodedURIComponent:function(input){if(null==input)return null;try{var b64=decodeURIComponent(input),str=atob(b64);return decodeURIComponent(escape(str))}catch(e){console.warn("LZString fallback decompress failed",e);try{return decodeURIComponent(input)}catch(e2){return input}}}};function initSameHeight(){$(".ntg-image-card-carousel .card .card-body, .same-height").sameHeight({flexible:!0,multiLine:!0,biggestHeight:!0})}function initMegaMenu(){ResponsiveHelper.addRange({"1200..":{on:function(){$(".ntg-main-nav__wrapper").accessibleMegaMenu("init"),$(".ntg-main-nav__panel").css("display","block")},off:function(){$(".ntg-main-nav__wrapper").accessibleMegaMenu("destroy")}}});const header=document.querySelector(".page-header-container"),navLinks=document.querySelectorAll(".ntg-main-nav__link > a");var openPanel=!1,lastScrollTop=(navLinks.forEach(function(link){const observer=new MutationObserver((mutationList,observer)=>{for(const mutation of mutationList)if("attributes"===mutation.type){var scrollPosition=scrollY;for(i=0;i<navLinks.length;i++){if(navLinks[i].classList.contains("open")){header.classList.add("header-scroll"),openPanel=!0;break}scrollPosition<=100&&header.classList.remove("header-scroll"),openPanel=!1}}});observer.observe(link,{attributes:!0})}),0);window.addEventListener("scroll",function(){var scrollTop=window.scrollY,scrollUp=scrollTop<lastScrollTop;if(Math.abs(lastScrollTop-scrollTop)<=5)return!1;scrollUp?scrollTop<=100&&(openPanel||header.classList.remove("header-scroll")):100<scrollTop&&(openPanel||header.classList.add("header-hide")),lastScrollTop=scrollTop}),window.addEventListener("resize",function(){var scrollPosition=scrollY;window.matchMedia("(max-width: 1200px)")&&scrollPosition<=100&&header.classList.remove("header-scroll"),window.matchMedia("(min-width: 1200px)")&&openPanel&&header.classList.add("header-scroll")}),document.querySelectorAll(".ntg-main-nav__panel").forEach(function(panel){var columns=panel.querySelector(".ntg-main-nav__panel-columns");if(!columns)return!1;columns.childElementCount<=1&&panel.classList.add("one-group")})}function initAddHoverClassOnCardHover(){const linkCards=document.querySelectorAll(".card--link-card");linkCards.forEach(card=>{card.addEventListener("mouseover",()=>{card.classList.add("hover")}),card.addEventListener("mouseout",()=>{card.classList.remove("hover")}),card.addEventListener("focus",()=>{card.classList.add("hover")}),card.addEventListener("blur",()=>{card.classList.remove("hover")})})}function initLinkCheck(){var links=document.querySelectorAll("#content a");if(!links)return!1;links.forEach(function(link){var arr=link.getAttribute("href").split(".");if(location.hostname!==link.hostname&&link.hostname.length)link.classList.add("external-link"),link.classList.contains("btn")?link.classList.add("btn-external"):(window.getComputedStyle(link).getPropertyValue("font-weight"),link.querySelector('[class*="fa-arrow-up-right-from-square"]')||link.querySelector("img")||link.querySelector('[class*="fa-brands"]')||link.insertAdjacentHTML("beforeend",'<i class="fa-solid fa-arrow-up-right-from-square ms-1 aria-hidden="true"></i>')),link.setAttribute("rel","noopener"),link.setAttribute("title","Opens in a new window"),link.setAttribute("target","_blank");else{if("pdf"!==arr[arr.length-1])return!1;link.setAttribute("rel","noopener"),link.setAttribute("title","Opens in a new window"),link.setAttribute("target","_blank")}})}function initPriorityNav(){if(!document.querySelector(".ntg-main-nav"))return!1;new PriorityNav(".ntg-main-nav")}function initResponsiveMenu(){if(!document.getElementById("mainmenu"))return!1;responsivemenu.init({wrapper:document.querySelector("#mainmenu")})}function initMmenu(){const mmenuWrapper=document.getElementById("mmenu-wrapper"),pageHeader=document.getElementsByClassName("page-header-container")[0];if(!mmenuWrapper)return!1;pageHeader.getAttribute("data-bs-theme")&&mmenuWrapper.setAttribute("data-bs-theme",pageHeader.getAttribute("data-bs-theme")),document.addEventListener("DOMContentLoaded",()=>{let options={offCanvas:{position:"right-front"}};mmenuWrapper.getAttribute("data-btn-link")&&mmenuWrapper.getAttribute("data-btn-text")&&(btnContent=`<a role="button" class="btn btn-light d-flex btn-mmenu" href="${mmenuWrapper.getAttribute("data-btn-link")}">${mmenuWrapper.getAttribute("data-btn-text")}</a>`,mmenuWrapper.removeAttribute("data-btn-link"),mmenuWrapper.removeAttribute("data-btn-text"),options.navbars=[{use:!0,position:"bottom",content:btnContent}]);const API=new Mmenu("#mmenu-wrapper",options).API;window.addEventListener("resize",function(){window.matchMedia("(min-width: 992px)").matches&&API.close()});var btnContent=document.querySelector(".mm-panels"),close=document.createElement("a");close.setAttribute("class","mm-btn mm-btn--close-wrapper mm-navbar__btn"),close.setAttribute("aria-label","Close menu"),close.setAttribute("href","#wrapper"),close.innerHTML=`<div class="mm-btn--close">
                                <span class="top-line" aria-hidden="true"></span>
                                <span class="bot-line" aria-hidden="true"></span>
                            </div>
                            <span class="mm-btn--close__text">Close</span>`,btnContent.prepend(close)})}function initMenuEdge(){var links=document.querySelectorAll(".ntg-main-nav__links > li");if(!links)return!1;links.forEach(link=>{var second=link.querySelector("ul > li > ul"),third=link.querySelector("ul > li > ul > li > ul");function avoidEdge(){var offset,left=offset(link).left,wnWidth=window.innerWidth,isSecondVisible=left+300<=wnWidth;function offset(elem){return{left:elem.getBoundingClientRect().left+window.scrollX}}left+600<=wnWidth?link.classList.remove("edge"):link.classList.add("edge"),isSecondVisible?link.classList.remove("all"):link.classList.add("all")}!second&&!third||link.classList.contains("more")||(link.addEventListener("mouseenter",function(){avoidEdge()}),link.addEventListener("keydown",function(){avoidEdge()}),link.addEventListener("touchstart",function(){avoidEdge()}))})}function initSuperfish(){$(function(){$("ul.sf-menu").superfish({delay:250,speed:250,speedOut:250,cssArrows:!1})})}function initStickyHeader(){var header=document.querySelector(".page-header-container"),banner=document.querySelector(".ntg-banner");(banner?new StickyHeader(header,banner):new StickyHeader(header)).init()}function initInPageNav(){var inPageNav=document.getElementById("in-page-nav");if(!inPageNav)return!1;var list=inPageNav.querySelector("ul");document.querySelectorAll("#content h2").forEach(function(element,index){if(0===index)return!1;element.querySelector("a")&&(element=element.querySelector("a")).parentElement,list.insertAdjacentHTML("beforeend",'<li><a href="#'+element.innerText.replace(/&amp;/g,"and").replace(/[^a-z0-9 ]/gi,"").replace(/\s/g,"-").toLowerCase()+'">'+element.innerText+"</a></li>"),element.setAttribute("id",element.innerText.replace(/&amp;/g,"and").replace(/[^a-z0-9 ]/gi,"").replace(/\s/g,"-").toLowerCase())})}function initSideNav(){var sideNavParents=document.querySelectorAll(".ntg-side-nav__collapser");if(!sideNavParents)return!1;for(var i=0;i<sideNavParents.length;i++)sideNavParents[i].addEventListener("click",function(e){e.preventDefault();e=this.parentElement.getElementsByClassName("collapse")[0];e.classList.contains("show")?(e.classList.remove("show"),this.classList.add("collapsed")):(e.classList.add("show"),this.classList.remove("collapsed"))})}function initScrollToTop(){var backToTop=document.querySelector(".back-to-top");if(!backToTop)return!1;var backToTopLink=backToTop.querySelector(".back-to-top button"),footer=document.querySelector(".ntg-footer"),isGoUpOn=!1;function checkFooterPosition(){var scrollBottom=document.body.clientHeight-document.documentElement.clientHeight-document.documentElement.scrollTop;scrollBottom<footer.offsetHeight?backToTop.style.marginBottom=footer.offsetHeight-scrollBottom+"px":backToTop.style.marginBottom=0}window.addEventListener("scroll",function(){isGoUpOn?window.pageYOffset<=500&&(fadeOut(backToTop),isGoUpOn=!1):500<window.pageYOffset&&(isGoUpOn=!0,fadeIn(backToTop)),checkFooterPosition()}),window.addEventListener("resize",function(){checkFooterPosition()}),backToTopLink.addEventListener("click",function(e){e.preventDefault(),document.querySelector("header a").focus({preventScroll:!0}),scroll({top:0,left:0,behavior:"smooth"})})}function initResponsiveTable(){document.querySelectorAll('[class*="custom-table-"]').forEach(function(element){responsiveCellHeaders(element),addTableAria(element)})}function initFlickity(){var carousels=document.querySelectorAll(".flickity-carousel");if(!carousels)return!1;carousels.forEach(function(carousel){var alignment=(alignment=carousel.getAttribute("data-align"))||"center",flkty=new Flickity(carousel,{cellAlign:alignment,pageDots:!1,on:{ready:function(){setSliderHeightToMax(this)}}});const cellElements=flkty.getCellElements();for(let i=0;i<cellElements.length;i++){const links=cellElements[i].querySelectorAll("a");0<links.length&&links.forEach(link=>{link.addEventListener("focus",e=>{flkty.select(i)})})}function setSliderHeightToMax(slider){slider.cells.forEach(cell=>cell.element.style.height="");let heights=slider.cells.map(cell=>cell.element.offsetHeight),max=Math.max.apply(Math,heights);slider.cells.forEach(cell=>cell.element.style.height=max+"px")}window.addEventListener("resize",function(){setSliderHeightToMax(flkty)})})}function toggleCarouselButton(){var carousels=document.querySelectorAll(".carousel"),paused=!1,initializedCarousels=[];carousels.forEach(carousel=>{let carouselOptions={ride:"carousel"};isNaN(parseInt(carousel.getAttribute("data-bs-interval")))?(carouselOptions.interval=!1,carouselOptions.ride=!1):(console.log(parseInt(carousel.getAttribute("data-bs-interval"))),carouselOptions.interval=parseInt(carousel.getAttribute("data-bs-interval")));carousel=new bootstrap.Carousel(carousel,carouselOptions);initializedCarousels.push(carousel)}),initializedCarousels.forEach(function(carousel){let bootstrapCarousel=carousel;const toggleButton=carousel._element.querySelector(".toggleCarouselBtn");if(toggleButton){let playPauseIcon=toggleButton.querySelector("i");toggleButton.addEventListener("click",function(e){paused=paused?(bootstrapCarousel.cycle(),bootstrapCarousel._config.ride="carousel",playPauseIcon.classList.remove("fa-play"),playPauseIcon.classList.add("fa-pause"),!1):(bootstrapCarousel.pause(),bootstrapCarousel._config.ride=!1,playPauseIcon.classList.remove("fa-pause"),playPauseIcon.classList.add("fa-play"),!0)})}})}function initCountUp(){document.querySelectorAll(".count-up").forEach(function(value){var target=value.innerHTML.replace(/[^\d.]/g,""),decimalPlaces=0,prefix="",suffix="";target.includes(".")&&(decimalPlaces=target.split(".")[1].length),value.hasAttribute("data-prefix")&&(prefix=value.getAttribute("data-prefix")),value.hasAttribute("data-suffix")&&(suffix=value.getAttribute("data-suffix")),new CountUp(value,target,{decimalPlaces:decimalPlaces,duration:3,prefix:prefix,suffix:suffix,enableScrollSpy:!0,scrollSpyOnce:1})})}function initResizeButtons(){function handleSizing(e,breakpoint){$(window).width()<=breakpoint?e.addClass("btn-sm"):e.removeClass("btn-sm")}$(".btn:not(.btn-sm)").each(function(){var btn=$(this);handleSizing(btn,974),$(window).on("resize",function(){handleSizing(btn,974)})})}function initResponsivePagination(){var pagination=document.querySelectorAll(".pagination");if(!pagination)return!1;function hidePageItems(elems){if(window.matchMedia("(max-width: 992px)").matches){if(5<elems.length)for(let i=0;i<elems.length;i++){var elem=elems[i];4<i&&!elem.classList.contains("d-none")&&elem.classList.add("d-none")}}else for(let i=0;i<elems.length;i++)(elem=elems[i]).classList.contains("d-none")&&elem.classList.remove("d-none")}pagination.forEach(e=>{var items=e.querySelectorAll(".page-item:not(.exclude)");hidePageItems(items),window.addEventListener("resize",function(){hidePageItems(items)})})}function initVideoControl(){document.querySelectorAll(".video-control").forEach(function(btn){btn.addEventListener("click",function(){var e=btn,videoID=e.getAttribute("data-video");(videoID=videoID&&document.getElementById(videoID))&&(e.classList.contains("pause")?(e.classList.remove("pause"),e.classList.add("play"),videoID.pause()):e.classList.contains("play")&&(e.classList.remove("play"),e.classList.add("pause"),videoID.play()))})})}function initQuizUI(){function updateProgressBar(){const stepper=document.querySelector(".stepper");if(stepper){const steps=stepper.querySelectorAll(".step");if(0!==steps.length){let activeIndex=-1;var progressWidth;steps.forEach((step,index)=>{step.classList.contains("active")&&(activeIndex=index)}),activeIndex<0||(progressWidth=1<steps.length?activeIndex/(steps.length-1)*100:0,stepper.style.setProperty("--progress-width",Math.min(100,Math.max(0,progressWidth))+"%"))}}}window.addEventListener("stepperUpdated",updateProgressBar),updateProgressBar()}window.State={currentState:{view:"start",quizId:null,currentPage:0,answers:{}},encodeState(stateObj){stateObj=JSON.stringify(stateObj);return LZString.compressToEncodedURIComponent(stateObj)},decodeState(str){if(!str)return null;try{var json=LZString.decompressFromEncodedURIComponent(str);return JSON.parse(json)}catch(e){return console.warn("Failed to decode state",e),null}},saveStateToUrl(stateObj,skipHashChange=!1){var stateObj=this.encodeState(stateObj),scrollX=window.scrollX,scrollY=window.scrollY;skipHashChange?(skipHashChange="#?state="+stateObj,window.location.hash!==skipHashChange&&history.replaceState(null,"",skipHashChange)):window.location.hash="#?state="+stateObj,window.scrollTo(scrollX,scrollY)},loadStateFromUrl(){const hash=window.location.hash||"";var parts=hash.split("?");if(parts.length<2)return null;parts=parts[1];const params=new URLSearchParams(parts);parts=params.get("state");return parts?this.decodeState(parts):null},clearState(){window.location.hash="#"}},window.Conditional={isVisible(question,answers){if(!question.conditional||!question.conditional.showWhen)return!0;var rule=question.conditional.showWhen;for(const key in rule){const expected=rule[key];var actual=answers[key];if(Array.isArray(expected)){if(!expected.includes(actual))return!1}else if(actual!==expected)return!1}return!0}},window.Modal={init(){this.modalEl=document.getElementById("resumeModal"),this.modal=new bootstrap.Modal(this.modalEl),this.btnResume=document.getElementById("btnResume"),this.btnFresh=document.getElementById("btnFresh"),this.btnResume.addEventListener("click",()=>{this.hide(),document.dispatchEvent(new CustomEvent("modal:resume"))}),this.btnFresh.addEventListener("click",()=>{this.hide(),document.dispatchEvent(new CustomEvent("modal:fresh"))})},show(){this.modal.show()},hide(){this.modal.hide()}},function(){async function fetchJSON(path){return window.JSONCache.get(path)}function getQuizUrl(quizId){var appEl=document.getElementById("app");return appEl&&appEl.dataset[quizId]?appEl.dataset[quizId]:`../assets/data/quizzes/${quizId}.json`}function isPageCompleted(page,answers){for(const q of page.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var ans=answers[subQ.id];if(null==ans||""===ans)return!1;if(Array.isArray(ans)&&0===ans.length)return!1}}else if(Conditional.isVisible(q,answers)){const ans=answers[q.id];if(void 0===ans||null===ans||""===ans)return!1;if(Array.isArray(ans)&&0===ans.length)return!1}return 0<page.questions.length&&page.questions.some(q=>"group"===q.type&&q.subQuestions?q.subQuestions.some(subQ=>Conditional.isVisible(subQ,answers)):Conditional.isVisible(q,answers))}function showInlineMessageForQuestion(question,questionEl,value){if(questionEl){const msgDiv=questionEl.querySelector(".inline-message");if(msgDiv&&(msgDiv.style.display="none",msgDiv.innerHTML="",question.messageOnSelect)){let payload=null;if("string"==typeof question.messageOnSelect?payload=question.messageOnSelect:value&&question.messageOnSelect[value]?payload=question.messageOnSelect[value]:question.messageOnSelect["*"]&&(payload=question.messageOnSelect["*"]),payload){if("string"==typeof payload)return msgDiv.innerHTML=payload,msgDiv.classList.remove("info-box"),void(msgDiv.style.display="block");questionEl=payload.class||"info-box";if(msgDiv.className="inline-message "+questionEl,payload.html)msgDiv.innerHTML=payload.html;else{let out="";payload.title&&(out+=`<strong>${payload.title}</strong>`),payload.body&&(out+=`<div>${payload.body}</div>`),msgDiv.innerHTML=out}msgDiv.style.display="block"}}}}function updatePageMessages(quiz,page){const messagesSection=document.getElementById("pageMessages");if(messagesSection){var ans,answers=window.State.currentState.answers||{};const messages={positive:[],recommendation:[]};for(const q of page.questions)if("group"===q.type&&q.subQuestions){let hasPositive=!1,hasNegative=!1;for(const subQ of q.subQuestions)Conditional.isVisible(subQ,answers)&&(ans=answers[subQ.id],"radio"===subQ.type&&(shouldShowMessage(subQ,ans,"positive")&&(hasPositive=!0),shouldShowMessage(subQ,ans,"recommendation")&&(hasNegative=!0)));hasPositive&&q.positiveMessage&&messages.positive.push(q.positiveMessage),hasNegative&&q.recommendation&&messages.recommendation.push(q.recommendation)}var page=JSON.stringify(messages),currentMessageKeys=messagesSection.dataset.messageKeys||"";if(page!==currentMessageKeys&&(messagesSection.dataset.messageKeys=page,messagesSection.innerHTML="",0<messages.positive.length||0<messages.recommendation.length)){const heading=document.createElement("h3");heading.textContent="Feedback",messagesSection.appendChild(heading),messages.positive.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item positive",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messagesSection.appendChild(msgDiv)}),messages.recommendation.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item recommendation",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messagesSection.appendChild(msgDiv)}),addExternalLinkIcons(messagesSection)}}}function shouldShowMessage(question,answer,messageType){if(answer){if("positive"===messageType&&question.positiveMessageOn)return question.positiveMessageOn.includes(answer);if("recommendation"===messageType&&question.recommendationOn)return question.recommendationOn.includes(answer);if("radio"===question.type){if("positive"===messageType)return question.showRecommendationOnYes?"No"===answer:"Yes"===answer;if("recommendation"===messageType)return question.showRecommendationOnYes?"Yes"===answer:"No"===answer||"Unsure"===answer}}}function addExternalLinkIcons(container){if(container){const links=container.querySelectorAll(".message-body a");links.forEach(function(link){const url=link.getAttribute("href");var arr;url&&(arr=url.split("."),location.hostname!==link.hostname&&link.hostname.length?(link.classList.add("external-link"),link.classList.contains("btn")?link.classList.add("btn-external"):link.querySelector('[class*="fa-arrow-up-right-from-square"]')||link.querySelector("img")||link.querySelector('[class*="fa-brands"]')||link.insertAdjacentHTML("beforeend",'<i class="fa-solid fa-arrow-up-right-from-square ms-1" aria-hidden="true"></i>'),link.setAttribute("rel","noopener")):"pdf"===arr[arr.length-1]&&(link.setAttribute("rel","noopener"),link.setAttribute("title","Opens in a new window"),link.setAttribute("target","_blank")))})}}function updateInlineQuestionMessages(quiz,page){var answers=window.State.currentState.answers||{};for(const q of page.questions)if("group"!==q.type||!q.subQuestions){const qEl=document.querySelector(`.question[data-qid="${q.id}"]`);if(qEl){const messageContainer=qEl.querySelector(".question-message");if(messageContainer)if(Conditional.isVisible(q,answers)){var ans=answers[q.id];let messageToShow=null;if("radio"===q.type&&(shouldShowMessage(q,ans,"positive")&&q.positiveMessage?messageToShow={...q.positiveMessage,type:"positive"}:shouldShowMessage(q,ans,"recommendation")&&q.recommendation&&(messageToShow={...q.recommendation,type:"recommendation"})),messageToShow){ans=JSON.stringify(messageToShow);if(ans!==(messageContainer.dataset.messageKey||"")){messageContainer.dataset.messageKey=ans,messageContainer.innerHTML="";const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item "+messageToShow.type,document.createElement("div")),body=(title.className="message-title",title.textContent=messageToShow.title,document.createElement("div"));body.className="message-body",body.innerHTML=messageToShow.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messageContainer.appendChild(msgDiv),addExternalLinkIcons(messageContainer)}}else messageContainer.innerHTML="",messageContainer.dataset.messageKey=""}else messageContainer.innerHTML=""}}}function updateConditionalGroupMessages(quiz,page){const answers=window.State.currentState.answers||{},conditionalGroups=document.querySelectorAll(".conditional-group-message");conditionalGroups.forEach(messageContainer=>{const parentQid=messageContainer.dataset.parentQid;if(parentQid){let parentQuestion=null;if(!(parentQuestion=page.questions.find(q=>q.id===parentQid)))for(const q of page.questions)if("group"===q.type&&q.subQuestions&&(parentQuestion=q.subQuestions.find(sq=>sq.id===parentQid)))break;if(parentQuestion){const messages={positive:[],recommendation:[]};let shouldShowPositive=!1,shouldShowRecommendation=!1;const wrapper=messageContainer.closest(".conditional-subquestion-group, .conditional-group");if(wrapper){const childQuestions=wrapper.querySelectorAll(".sub-question, .question");childQuestions.forEach(childEl=>{var childQuestion,childEl=childEl.dataset.qid;childEl!==parentQid&&(childQuestion=findQuestionInQuiz(quiz,childEl))&&childQuestion.conditional&&childQuestion.conditional.showWhen&&Object.keys(childQuestion.conditional.showWhen)[0]===parentQid&&Conditional.isVisible(childQuestion,answers)&&(childEl=answers[childEl],"radio"===childQuestion.type&&(shouldShowMessage(childQuestion,childEl,"positive")&&(shouldShowPositive=!0),shouldShowMessage(childQuestion,childEl,"recommendation")&&(shouldShowRecommendation=!0)))})}shouldShowPositive&&parentQuestion.conditionalQuestionGroupPositiveMessage&&(messages.positive.some(m=>m.title===parentQuestion.conditionalQuestionGroupPositiveMessage.title)||messages.positive.push(parentQuestion.conditionalQuestionGroupPositiveMessage)),shouldShowRecommendation&&parentQuestion.conditionalQuestionGroupRecommendation&&(messages.recommendation.some(m=>m.title===parentQuestion.conditionalQuestionGroupRecommendation.title)||messages.recommendation.push(parentQuestion.conditionalQuestionGroupRecommendation));var newMessageKeys=JSON.stringify(messages);newMessageKeys!==(messageContainer.dataset.messageKey||"")&&(messageContainer.dataset.messageKey=newMessageKeys,messageContainer.innerHTML="",(0<messages.positive.length||0<messages.recommendation.length)&&(messages.positive.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item positive",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messageContainer.appendChild(msgDiv)}),messages.recommendation.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item recommendation",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),messageContainer.appendChild(msgDiv)})))}}})}function findQuestionInQuiz(quiz,qid){for(const page of quiz.pages)for(const q of page.questions){if(q.id===qid)return q;if("group"===q.type&&q.subQuestions)for(const subQ of q.subQuestions)if(subQ.id===qid)return subQ}return null}function updateConditionalGroupBorders(quiz){const wrappers=document.querySelectorAll(".conditional-subquestion-group");wrappers.forEach(wrapper=>{const subQuestions=wrapper.querySelectorAll(".sub-question");let hasConditional=!1;subQuestions.forEach(sq=>{sq=sq.dataset.qid,sq=findQuestionInQuiz(quiz,sq);sq&&sq.conditional&&sq.conditional.showWhen&&(hasConditional=!0)});var hasClass=wrapper.classList.contains("has-visible-conditional");hasConditional&&!hasClass?wrapper.classList.add("has-visible-conditional"):!hasConditional&&hasClass&&wrapper.classList.remove("has-visible-conditional")})}window.UI={renderStart:async function(contentEl,uiMessages){document.getElementById("pageTitle").textContent=uiMessages.introTitle||"Get Started",contentEl.innerHTML="";const wrapper=document.createElement("div"),p=document.createElement("div"),nav=(p.innerHTML=uiMessages.introText||"Start the quizzes to assess your business safety.",document.createElement("div")),btn=(nav.className="nav-buttons",document.createElement("button"));btn.className="primary",btn.textContent="Choose a topic",btn.addEventListener("click",()=>{window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState);const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&quizBody.scrollIntoView({behavior:"smooth",block:"start"})}),nav.appendChild(btn),wrapper.appendChild(p),wrapper.appendChild(nav),contentEl.appendChild(wrapper)},renderChooseTopic:async function(contentEl,navJson){document.getElementById("pageTitle").textContent="Choose a Topic",contentEl.innerHTML="";const grid=document.createElement("div");grid.className="cards";for(const q of navJson.quizzes){const card=document.createElement("div"),imageWrap=(card.className="card quiz-card",document.createElement("div")),img=(imageWrap.className="card-image",document.createElement("img")),content=(img.src=q.icon||"../assets/images/quiz-placeholder.jpg",img.alt=q.title,imageWrap.appendChild(img),document.createElement("div")),title=(content.className="card-content",document.createElement("h3")),desc=(title.textContent=q.title,document.createElement("p")),startBtn=(desc.textContent=q.description,document.createElement("a")),progressWrap=(startBtn.className="card-link",startBtn.textContent="Take the Questionnaire",startBtn.innerHTML='Take the Questionnaire <i class="fa-solid fa-chevron-right"></i>',startBtn.href="#",startBtn.addEventListener("click",e=>{e.preventDefault(),window.State&&(window.State.currentState.view="quiz",window.State.currentState.quizId=q.id,window.State.currentState.currentPage=0,window.State.currentState.answers||(window.State.currentState.answers={}),window.State.saveStateToUrl(window.State.currentState))}),content.appendChild(title),content.appendChild(desc),content.appendChild(startBtn),document.createElement("div"));progressWrap.className="card-progress";var percent=await async function(quizId){try{var ans,quiz=await fetchJSON(getQuizUrl(quizId)),answers=window.State&&window.State.currentState&&window.State.currentState.answers||{};let total=0,answered=0;for(const page of quiz.pages)for(const question of page.questions)if("group"===question.type&&question.subQuestions)for(const subQ of question.subQuestions)Conditional.isVisible(subQ,answers)&&(total++,null!=(ans=answers[subQ.id])&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++);else if(Conditional.isVisible(question,answers)){total++;const ans=answers[question.id];void 0!==ans&&null!==ans&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++}return total?Math.round(answered/total*100):0}catch(e){return 0}}(q.id);const circleProgress=document.createElement("div"),svg=(circleProgress.className="circle-progress",document.createElementNS("http://www.w3.org/2000/svg","svg")),circleBg=(svg.setAttribute("width","100"),svg.setAttribute("height","100"),svg.setAttribute("viewBox","0 0 100 100"),document.createElementNS("http://www.w3.org/2000/svg","circle")),circleFill=(circleBg.setAttribute("cx","50"),circleBg.setAttribute("cy","50"),circleBg.setAttribute("r","45"),circleBg.setAttribute("fill","none"),circleBg.setAttribute("stroke","#e0e0e0"),circleBg.setAttribute("stroke-width","8"),document.createElementNS("http://www.w3.org/2000/svg","circle")),percentLabel=(circleFill.setAttribute("cx","50"),circleFill.setAttribute("cy","50"),circleFill.setAttribute("r","45"),circleFill.setAttribute("fill","none"),circleFill.setAttribute("stroke","#0093b8"),circleFill.setAttribute("stroke-width","8"),circleFill.setAttribute("stroke-dasharray","283"),circleFill.setAttribute("stroke-dashoffset",String(283-283*percent/100)),circleFill.setAttribute("transform","rotate(-90 50 50)"),svg.appendChild(circleBg),svg.appendChild(circleFill),document.createElement("div"));percentLabel.className="percent-label",percentLabel.innerHTML=`<strong>${percent}%</strong><br><span>Complete</span>`,circleProgress.appendChild(svg),circleProgress.appendChild(percentLabel),progressWrap.appendChild(circleProgress),card.appendChild(imageWrap),card.appendChild(content),card.appendChild(progressWrap),grid.appendChild(card)}contentEl.appendChild(grid)},renderQuizPage:async function(contentEl,quizId,pageIndex){document.getElementById("pageTitle").textContent="Quiz",contentEl.innerHTML="";const quiz=await fetchJSON(getQuizUrl(quizId));if(quiz){window.State&&(window.State.currentState.quizId=quizId);const stepper=document.createElement("div"),answers=(stepper.className="stepper",window.State.currentState.answers||{}),resultsStep=(quiz.pages.forEach((p,idx)=>{const s=document.createElement("a");s.href="#",s.className="step",s.textContent=p.title||"Page "+(idx+1);var pageComplete=isPageCompleted(p,answers);let pageHasAnswers=!1;for(const q of p.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var a=answers[subQ.id];if(null!=a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}if(pageHasAnswers)break}else if(Conditional.isVisible(q,answers)){const a=answers[q.id];if(void 0!==a&&null!==a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}pageComplete?s.classList.add("completed"):pageHasAnswers&&s.classList.add("in-progress"),idx===pageIndex?s.classList.add("active"):idx<pageIndex&&s.classList.add("completed"),s.addEventListener("click",e=>{e.preventDefault(),window.State.currentState.view="quiz",window.State.currentState.currentPage=idx,window.State.saveStateToUrl(window.State.currentState)}),stepper.appendChild(s)}),document.createElement("a")),page=(resultsStep.href="#",resultsStep.className="step",resultsStep.textContent="Your results",resultsStep.addEventListener("click",e=>{e.preventDefault(),window.State.currentState.view="results",window.State.saveStateToUrl(window.State.currentState)}),stepper.appendChild(resultsStep),contentEl.appendChild(stepper),window.dispatchEvent(new CustomEvent("stepperUpdated")),quiz.pages[pageIndex]),pageTitle=document.createElement("div"),qwraps=(pageTitle.className="page-title",pageTitle.textContent=page.title,contentEl.appendChild(pageTitle),[]),idToIndex=(page.questions.forEach(question=>{if("group"===question.type){const groupWrap=document.createElement("div"),groupHeader=(groupWrap.className="question-group",groupWrap.dataset.qid=question.id,document.createElement("div"));if(groupHeader.className="question-group-header",question.helpText){const labelWrapper=document.createElement("div"),label=(labelWrapper.className="question-label-wrapper",document.createElement("label")),helpIcon=(label.textContent=question.label||question.id,document.createElement("button"));helpIcon.type="button",helpIcon.className="help-icon",helpIcon.textContent="i",helpIcon.setAttribute("data-bs-toggle","tooltip"),helpIcon.setAttribute("data-bs-placement","top"),helpIcon.setAttribute("data-bs-title",question.helpText),labelWrapper.appendChild(label),labelWrapper.appendChild(helpIcon),groupHeader.appendChild(labelWrapper)}else{const label=document.createElement("label");label.textContent=question.label||question.id,groupHeader.appendChild(label)}if(groupWrap.appendChild(groupHeader),question.subQuestions&&0<question.subQuestions.length){const subQMap={},conditionalGroups=(question.subQuestions.forEach((subQ,idx)=>{subQMap[subQ.id]=idx}),{}),processed=(question.subQuestions.forEach((subQ,idx)=>{subQ.conditional&&subQ.conditional.showWhen&&(subQ=Object.keys(subQ.conditional.showWhen)[0],void 0!==subQMap[subQ]&&(subQ=subQMap[subQ],conditionalGroups[subQ]=conditionalGroups[subQ]||[],conditionalGroups[subQ].push(idx)))}),new Set);question.subQuestions.forEach((subQ,idx)=>{if(!processed.has(idx))if(conditionalGroups[idx]){const condWrapper=document.createElement("div");condWrapper.className="conditional-subquestion-group";var parentEl=createQuestionElement(subQ,!0);condWrapper.appendChild(parentEl),processed.add(idx),conditionalGroups[idx].forEach(childIdx=>{var childEl=createQuestionElement(question.subQuestions[childIdx],!0);condWrapper.appendChild(childEl),processed.add(childIdx)});const conditionalGroupMessageDiv=document.createElement("div");conditionalGroupMessageDiv.className="conditional-group-message",conditionalGroupMessageDiv.dataset.parentQid=subQ.id,condWrapper.appendChild(conditionalGroupMessageDiv),groupWrap.appendChild(condWrapper)}else{parentEl=createQuestionElement(subQ,!0);groupWrap.appendChild(parentEl),processed.add(idx)}})}qwraps.push(groupWrap)}else qwraps.push(createQuestionElement(question,!1))}),{}),groups=(page.questions.forEach((q,i)=>idToIndex[q.id]=i),{}),appended=(page.questions.forEach((q,i)=>{q.conditional&&q.conditional.showWhen&&((q=Object.keys(q.conditional.showWhen||{})).length&&(q=q[0],void 0!==(q=idToIndex[q])&&(groups[q]=groups[q]||[],groups[q].push(i))))}),new Set);for(let i=0;i<page.questions.length;i++)if(!appended.has(i))if(groups[i]){const childIndices=(groups[i]||[]).slice().sort((a,b)=>a-b);if(1==childIndices.length){var ci=childIndices[0];const groupDiv=document.createElement("div"),conditionalGroupMessageDiv=(groupDiv.className="conditional-group",groupDiv.appendChild(qwraps[i]),appended.add(i),appended.has(ci)||(groupDiv.appendChild(qwraps[ci]),appended.add(ci)),document.createElement("div"));conditionalGroupMessageDiv.className="conditional-group-message",conditionalGroupMessageDiv.dataset.parentQid=page.questions[i].id,groupDiv.appendChild(conditionalGroupMessageDiv),contentEl.appendChild(groupDiv)}else{const groupDiv=document.createElement("div"),conditionalGroupMessageDiv=(groupDiv.className="conditional-group",groupDiv.appendChild(qwraps[i]),appended.add(i),childIndices.forEach(ci=>{appended.has(ci)||(groupDiv.appendChild(qwraps[ci]),appended.add(ci))}),document.createElement("div"));conditionalGroupMessageDiv.className="conditional-group-message",conditionalGroupMessageDiv.dataset.parentQid=page.questions[i].id,groupDiv.appendChild(conditionalGroupMessageDiv),contentEl.appendChild(groupDiv)}}else{let isChild=!1;for(const pIdx in groups)if(groups[pIdx].includes(i)){isChild=!0;break}isChild||(contentEl.appendChild(qwraps[i]),appended.add(i))}const messagesSection=document.createElement("div"),nav=(messagesSection.className="page-messages",messagesSection.id="pageMessages",contentEl.appendChild(messagesSection),document.createElement("div")),back=(nav.className="nav-buttons",document.createElement("button")),next=(back.className="secondary",back.textContent="Previous page",document.createElement("button"));next.className="primary",next.textContent="Next page",back.disabled=0===pageIndex,back.addEventListener("click",()=>{var prev=Math.max(0,pageIndex-1);window.State.currentState.view="quiz",window.State.currentState.currentPage=prev,window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&quizBody.scrollIntoView({behavior:"smooth",block:"start"})},100)}),next.addEventListener("click",()=>{var nextPage=Math.min(quiz.pages.length-1,pageIndex+1);nextPage===pageIndex?window.State.currentState.view="results":(window.State.currentState.view="quiz",window.State.currentState.currentPage=nextPage),window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&quizBody.scrollIntoView({behavior:"smooth",block:"start"})},100)}),nav.appendChild(back),nav.appendChild(next),contentEl.appendChild(nav);var stateAnswers=window.State.currentState.answers||{};for(const qEl of contentEl.querySelectorAll(".question, .sub-question")){var qid=qEl.dataset.qid;const question=findQuestionInQuiz(quiz,qid);if(question){if("radio"===question.type){var val=stateAnswers[qid];if(val){const inp=qEl.querySelector(`input[type=radio][value="${val}"]`);inp&&(inp.checked=!0)}}else if("checkbox"===question.type){const val=stateAnswers[qid]||[];qEl.querySelectorAll("input[type=checkbox]").forEach(ch=>{ch.checked=val.includes(ch.value)})}else{const val=stateAnswers[qid],inp=qEl.querySelector("input");inp&&void 0!==val&&(inp.value=val)}val=function(){var sel;if("radio"===question.type)return(sel=qEl.querySelector("input[type=radio]:checked"))?sel.value:null;if("checkbox"!==question.type)return(sel=qEl.querySelector("input"))?sel.value:null;{const arr=[];return qEl.querySelectorAll("input[type=checkbox]:checked").forEach(c=>arr.push(c.value)),arr}}();showInlineMessageForQuestion(question,qEl,val),qEl.addEventListener("change",ev=>{const focusedInputId=ev.target?ev.target.id:null;!function(ev,quiz,pageIndex){const target=ev.target,questionEl=target.closest(".question, .sub-question");if(questionEl){var ev=questionEl.dataset.qid,question=findQuestionInQuiz(quiz,ev);if(question){const focusedInputId=target.id;let value;if("radio"===question.type){var sel=questionEl.querySelector("input[type=radio]:checked");value=sel?sel.value:null}else if("checkbox"===question.type){const arr=[];questionEl.querySelectorAll("input[type=checkbox]:checked").forEach(ch=>arr.push(ch.value)),value=arr}else{sel=questionEl.querySelector("input");value=sel?sel.value:null,"number"===question.type&&""!==value&&(value=Number(value))}if(window.State.currentState.answers||(window.State.currentState.answers={}),window.State.currentState.answers[ev]=value,window.State.currentState.currentPage=pageIndex,question.messageOnSelect){const msgDiv=questionEl.querySelector(".inline-message");let shown=!1;if("string"==typeof value&&question.messageOnSelect[value])msgDiv.textContent=question.messageOnSelect[value],msgDiv.style.display="block",shown=!0;else if(Array.isArray(value))for(const v of value)if(question.messageOnSelect[v]){msgDiv.textContent=question.messageOnSelect[v],msgDiv.style.display="block",shown=!0;break}shown||(msgDiv.style.display="none")}for(const other of document.querySelectorAll(".question, .sub-question")){var otherId=other.dataset.qid,q=findQuestionInQuiz(quiz,otherId);q&&(q=Conditional.isVisible(q,window.State.currentState.answers||{}),other.style.display=q?"":"none",q||delete window.State.currentState.answers[otherId])}updateConditionalGroupBorders(quiz),focusedInputId&&setTimeout(()=>{const inputToFocus=document.getElementById(focusedInputId);inputToFocus&&inputToFocus.focus()},0),window.State.saveStateToUrl(window.State.currentState,!0)}}}(ev,quiz,pageIndex);ev=function(){var sel;if("radio"===question.type)return(sel=qEl.querySelector("input[type=radio]:checked"))?sel.value:null;if("checkbox"!==question.type)return(sel=qEl.querySelector("input"))?sel.value:null;{const arr=[];return qEl.querySelectorAll("input[type=checkbox]:checked").forEach(c=>arr.push(c.value)),arr}}();showInlineMessageForQuestion(question,qEl,ev),updatePageMessages(quiz,page),updateInlineQuestionMessages(quiz,page),updateConditionalGroupMessages(quiz,page),focusedInputId&&setTimeout(()=>{const inputToFocus=document.getElementById(focusedInputId);inputToFocus&&inputToFocus.focus()},10)})}}function createQuestionElement(question,isSubQuestion=!1){const qwrap=document.createElement("div");if(qwrap.className=isSubQuestion?"sub-question":"question",qwrap.dataset.qid=question.id,question.helpText){const labelWrapper=document.createElement("div"),label=(labelWrapper.className="question-label-wrapper",document.createElement("label")),helpIcon=(label.textContent=question.label||question.id,document.createElement("button"));helpIcon.type="button",helpIcon.className="help-icon",helpIcon.textContent="i",helpIcon.setAttribute("data-bs-toggle","tooltip"),helpIcon.setAttribute("data-bs-placement","top"),helpIcon.setAttribute("data-bs-title",question.helpText),labelWrapper.appendChild(label),labelWrapper.appendChild(helpIcon),qwrap.appendChild(labelWrapper)}else{const label=document.createElement("label");label.textContent=question.label||question.id,qwrap.appendChild(label)}const optionsWrap=document.createElement("div");if(optionsWrap.className="options",void 0!==question.minScore&&(qwrap.dataset.minScore=question.minScore),Conditional.isVisible(question,window.State.currentState.answers||{})||(qwrap.style.display="none"),"radio"===question.type)question.options.forEach(opt=>{var isObj="object"==typeof opt&&null!==opt,optionLabel=isObj?opt.label||opt.value:String(opt),optionValue=isObj?opt.value||opt.label:String(opt),isObj=isObj&&void 0!==opt.score?Number(opt.score):"yes"===String(optionLabel).toLowerCase()?1:0,opt=(question.id+"__"+optionValue).replace(/\s+/g,"_");const div=document.createElement("div"),inp=document.createElement("input"),lab=(inp.type="radio",inp.name=question.id,inp.value=optionValue,inp.id=opt,inp.dataset.score=String(isObj),document.createElement("label"));lab.htmlFor=opt,lab.textContent=optionLabel,div.appendChild(inp),div.appendChild(lab),optionsWrap.appendChild(div)});else if("checkbox"===question.type)question.options.forEach(opt=>{var opt=String(opt),id=(question.id+"__"+opt).replace(/\s+/g,"_");const div=document.createElement("div"),inp=document.createElement("input"),lab=(inp.type="checkbox",inp.name=question.id,inp.value=opt,inp.id=id,document.createElement("label"));lab.htmlFor=id,lab.textContent=opt,div.appendChild(inp),div.appendChild(lab),optionsWrap.appendChild(div)});else if("number"===question.type||"text"===question.type){const inp=document.createElement("input");inp.type="number"===question.type?"number":"text",inp.name=question.id,inp.className="text-input",optionsWrap.appendChild(inp)}qwrap.appendChild(optionsWrap);const messageDiv=document.createElement("div"),questionMessageDiv=(messageDiv.className="inline-message",messageDiv.style.display="none",qwrap.appendChild(messageDiv),document.createElement("div"));return questionMessageDiv.className="question-message",questionMessageDiv.dataset.qid=question.id,qwrap.appendChild(questionMessageDiv),qwrap}updateConditionalGroupBorders(quiz),updatePageMessages(quiz,page),updateInlineQuestionMessages(quiz,page),updateConditionalGroupMessages(quiz,page),window.bootstrap&&window.bootstrap.Tooltip&&[...contentEl.querySelectorAll('[data-bs-toggle="tooltip"]')].map(tooltipTriggerEl=>new window.bootstrap.Tooltip(tooltipTriggerEl))}else contentEl.textContent="Quiz not found."},renderResults:async function(contentEl,quizId){document.getElementById("pageTitle").textContent="Results",contentEl.innerHTML="";const quiz=await window.JSONCache.get(getQuizUrl(quizId)),answers=window.State.currentState.answers||{},stepper=document.createElement("div"),resultsStep=(stepper.className="stepper",quiz.pages.forEach((p,idx)=>{const s=document.createElement("a");s.href="#",s.className="step",s.textContent=p.title||"Page "+(idx+1);var pageComplete=isPageCompleted(p,answers);let pageHasAnswers=!1;for(const q of p.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var a=answers[subQ.id];if(null!=a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}if(pageHasAnswers)break}else if(Conditional.isVisible(q,answers)){const a=answers[q.id];if(void 0!==a&&null!==a&&""!==a){if(Array.isArray(a)&&0<a.length){pageHasAnswers=!0;break}if(!Array.isArray(a)){pageHasAnswers=!0;break}}}pageComplete?s.classList.add("completed"):pageHasAnswers&&s.classList.add("in-progress"),s.classList.add("completed"),s.addEventListener("click",e=>{e.preventDefault(),window.State.currentState.view="quiz",window.State.currentState.currentPage=idx,window.State.saveStateToUrl(window.State.currentState)}),stepper.appendChild(s)}),document.createElement("a"));resultsStep.href="#",resultsStep.className="step active",resultsStep.textContent="Your results",stepper.appendChild(resultsStep),contentEl.appendChild(stepper),window.dispatchEvent(new CustomEvent("stepperUpdated"));let totalScore=0,totalPossible=0;const pageScores=[];for(const page of quiz.pages){let pageScore=0,pagePossible=0;for(const q of page.questions)if("group"===q.type&&q.subQuestions){for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){var maxScore;"radio"===subQ.type&&subQ.options&&(maxScore=Math.max(...subQ.options.map(opt=>"object"==typeof opt&&void 0!==opt.score?Number(opt.score):1)),pagePossible+=maxScore);let qScore=0;if("radio"===subQ.type){const val=answers[subQ.id];void 0===val||null===val||(maxScore=(subQ.options||[]).find(o=>"object"==typeof o?(o.value||o.label)==val||o.label==val:o==val))&&(qScore="object"==typeof maxScore&&void 0!==maxScore.score?Number(maxScore.score):"yes"===String(val).toLowerCase()?1:0)}pageScore+=qScore}}else if(Conditional.isVisible(q,answers)){if("radio"===q.type&&q.options){const maxScore=Math.max(...q.options.map(opt=>"object"==typeof opt&&void 0!==opt.score?Number(opt.score):1));pagePossible+=maxScore}else"checkbox"===q.type&&void 0!==q.minScore&&(pagePossible+=Number(q.minScore));let qScore=0;if("radio"===q.type){const val=answers[q.id];if(void 0!==val&&null!==val){const opt=(q.options||[]).find(o=>"object"==typeof o?(o.value||o.label)==val||o.label==val:o==val);opt&&(qScore="object"==typeof opt&&void 0!==opt.score?Number(opt.score):"yes"===String(val).toLowerCase()?1:0)}}else{var val;"checkbox"===q.type&&(val=answers[q.id]||[],val=Array.isArray(val)?val.length:0,void 0!==q.minScore&&q.minScore&&val>=Number(q.minScore)&&(qScore=Number(q.minScore)))}pageScore+=qScore}totalScore+=pageScore,totalPossible+=pagePossible,pageScores.push({title:page.title,score:pageScore,possible:pagePossible,percentage:0<pagePossible?Math.round(pageScore/pagePossible*100):0})}const overallCard=document.createElement("div"),overallTitle=(overallCard.className="quiz-results",document.createElement("h3")),healthScoreLabel=(overallTitle.textContent="Overall Health",overallCard.appendChild(overallTitle),document.createElement("div")),scoreCircle=(healthScoreLabel.classList.add("health-score-label"),healthScoreLabel.textContent="Health Score",overallCard.appendChild(healthScoreLabel),document.createElement("div")),overallPercentage=(scoreCircle.classList.add("score-circle"),0<totalPossible?Math.round(totalScore/totalPossible*100):0),percentText=(scoreCircle.style.setProperty("--score-percentage",""+overallPercentage),document.createElement("div")),strengthText=(percentText.textContent=overallPercentage+"%",percentText.classList.add("percent-text"),document.createElement("div")),contactBtn=(strengthText.textContent="Strengths",strengthText.classList.add("strength-text"),scoreCircle.appendChild(percentText),scoreCircle.appendChild(strengthText),overallCard.appendChild(scoreCircle),pageScores.forEach(ps=>{const scoreSection=document.createElement("div"),scoreTitle=(scoreSection.classList.add("page-score-section"),document.createElement("div")),progressBar=(scoreTitle.textContent=ps.title+" Score",scoreTitle.classList.add("page-score-title"),scoreSection.appendChild(scoreTitle),document.createElement("div")),progressFill=(progressBar.className="progress",document.createElement("i")),scoreValue=(progressFill.style.width=ps.percentage+"%",progressBar.appendChild(progressFill),scoreSection.appendChild(progressBar),document.createElement("div"));scoreValue.textContent=ps.score+"/"+ps.possible,scoreValue.classList.add("page-score-value"),scoreSection.appendChild(scoreValue),overallCard.appendChild(scoreSection)}),contentEl.appendChild(overallCard),document.createElement("a")),aiSummarySection=(contactBtn.href="#",contactBtn.className="btn btn-primary mb-4",contactBtn.textContent="Contact a Territory Business Advisor",contactBtn.addEventListener("click",e=>{e.preventDefault();e=document.getElementById("floatingContact");if(e&&window.bootstrap&&window.bootstrap.Modal){const modal=new window.bootstrap.Modal(e);modal.show()}else window.location.href="https://business.nt.gov.au/contact"}),contentEl.appendChild(contactBtn),document.createElement("div")),recommendationsCard=(aiSummarySection.classList.add("ai-summary-section"),aiSummarySection.innerHTML='<div class="summary-loading"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div><span class="ms-2">Generating AI summary...</span></div>',overallCard.appendChild(aiSummarySection),(async()=>{if(window.AISummaryGenerator){window.AISummaryGenerator.initFromDataAttribute();var summary=await window.AISummaryGenerator.generateSummary({quizId:quizId,quizTitle:quiz.title||"Business Health Assessment",overallPercentage:overallPercentage,pageScores:pageScores,answers:answers,quiz:quiz});if(summary){aiSummarySection.innerHTML="";const summaryTitle=document.createElement("h4"),summaryContent=(summaryTitle.textContent=summary.title,summaryTitle.classList.add("summary-title"),document.createElement("p"));summaryContent.textContent=summary.content,summaryContent.classList.add("summary-content"),aiSummarySection.appendChild(summaryTitle),aiSummarySection.appendChild(summaryContent)}else aiSummarySection.remove()}else aiSummarySection.remove()})(),document.createElement("div")),recTitle=(recommendationsCard.className="quiz-recommendations",document.createElement("h3"));recTitle.textContent="Recommendations",recommendationsCard.appendChild(recTitle);let hasRecommendations=!1;for(const page of quiz.pages){const pageRecs={positive:[],recommendation:[]};for(const q of page.questions)if("group"===q.type&&q.subQuestions){let hasPositive=!1,hasNegative=!1;for(const subQ of q.subQuestions){var ans;Conditional.isVisible(subQ,answers)&&(ans=answers[subQ.id],"radio"===subQ.type&&("Yes"===ans&&(hasPositive=!0),"No"!==ans&&"Unsure"!==ans||(hasNegative=!0)))}hasPositive&&q.positiveMessage&&pageRecs.positive.push(q.positiveMessage),hasNegative&&q.recommendation&&pageRecs.recommendation.push(q.recommendation);for(const subQ of q.subQuestions)if(Conditional.isVisible(subQ,answers)){const ans=answers[subQ.id];if("radio"===subQ.type){var isConditional=subQ.conditional&&subQ.conditional.showWhen;let parentQuestion=null;if(isConditional){const dependsOnId=Object.keys(subQ.conditional.showWhen)[0];parentQuestion=q.subQuestions.find(sq=>sq.id===dependsOnId)}(subQ.showRecommendationOnYes?"No"===ans:"Yes"===ans)&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupPositiveMessage?pageRecs.positive.some(m=>m.title===parentQuestion.conditionalQuestionGroupPositiveMessage.title)||pageRecs.positive.push(parentQuestion.conditionalQuestionGroupPositiveMessage):subQ.positiveMessage&&pageRecs.positive.push(subQ.positiveMessage));var shouldShowRec=subQ.showRecommendationOnYes?"Yes"===ans:"No"===ans||"Unsure"===ans;shouldShowRec&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupRecommendation?pageRecs.recommendation.some(m=>m.title===parentQuestion.conditionalQuestionGroupRecommendation.title)||pageRecs.recommendation.push(parentQuestion.conditionalQuestionGroupRecommendation):subQ.recommendation&&pageRecs.recommendation.push(subQ.recommendation))}}}else if(Conditional.isVisible(q,answers)){const ans=answers[q.id];if("radio"===q.type){const isConditional=q.conditional&&q.conditional.showWhen;let parentQuestion=null;if(isConditional){const dependsOnId=Object.keys(q.conditional.showWhen)[0];parentQuestion=page.questions.find(pq=>pq.id===dependsOnId)}const shouldShowPos=q.showRecommendationOnYes?"No"===ans:"Yes"===ans,shouldShowRec=(shouldShowPos&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupPositiveMessage?pageRecs.positive.some(m=>m.title===parentQuestion.conditionalQuestionGroupPositiveMessage.title)||pageRecs.positive.push(parentQuestion.conditionalQuestionGroupPositiveMessage):q.positiveMessage&&pageRecs.positive.push(q.positiveMessage)),q.showRecommendationOnYes?"Yes"===ans:"No"===ans||"Unsure"===ans);shouldShowRec&&(isConditional&&parentQuestion&&parentQuestion.conditionalQuestionGroupRecommendation?pageRecs.recommendation.some(m=>m.title===parentQuestion.conditionalQuestionGroupRecommendation.title)||pageRecs.recommendation.push(parentQuestion.conditionalQuestionGroupRecommendation):q.recommendation&&pageRecs.recommendation.push(q.recommendation))}}if(0<pageRecs.recommendation.length){hasRecommendations=!0;const pageSection=document.createElement("div"),pageHeading=(pageSection.className="page-recommendations",document.createElement("h4"));pageHeading.textContent=page.title,pageSection.appendChild(pageHeading),pageRecs.recommendation.forEach(msg=>{const msgDiv=document.createElement("div"),title=(msgDiv.className="message-item recommendation",document.createElement("div")),body=(title.className="message-title",title.textContent=msg.title,document.createElement("div"));body.className="message-body",body.innerHTML=msg.body,msgDiv.appendChild(title),msgDiv.appendChild(body),pageSection.appendChild(msgDiv)}),recommendationsCard.appendChild(pageSection)}}hasRecommendations&&contentEl.appendChild(recommendationsCard);const actionsWrap=document.createElement("div"),copyBtn=(actionsWrap.classList.add("results-actions"),document.createElement("button")),printBtn=(copyBtn.className="secondary",copyBtn.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-link"></i><span>Copy link to this report</span>'),document.createElement("button")),pdfBtn=(printBtn.className="secondary",printBtn.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-print"></i><span>Print results</span>'),document.createElement("button"));pdfBtn.className="primary",pdfBtn.textContent="Download report",pdfBtn.addEventListener("click",async()=>{if(window.html2pdf){const contentEl=document.getElementById("quizContent"),clone=contentEl.cloneNode(!0),actionsWrap=clone.querySelector(".results-actions"),stepper=(actionsWrap&&actionsWrap.querySelector("button")&&actionsWrap.remove(),clone.querySelector(".stepper")),navButtons=(stepper&&stepper.remove(),clone.querySelector(".quiz-nav-buttons")),contactButton=(navButtons&&navButtons.remove(),clone.querySelector(".btn.btn-primary.mb-4")),titleElement=(contactButton&&contactButton.remove(),document.createElement("h1")),newWin=(titleElement.textContent=quiz.title||"Business Health Report",titleElement.style.fontSize="24px",titleElement.style.fontWeight="700",titleElement.style.marginBottom="20px",clone.insertBefore(titleElement,clone.firstChild),window.open("","_blank"));var html;newWin?(html=`<!doctype html><html><head><meta charset="utf-8">${Array.from(document.querySelectorAll("link[rel=stylesheet]")).map(l=>`<link rel="stylesheet" href="${l.href}">`).join("\n")}${Array.from(document.querySelectorAll("style")).map(s=>`<style>${s.innerHTML}</style>`).join("\n")}<title>PDF - ${quiz.title||"Business Health Report"}</title></head><body><div class="ntg-quiz-body">${clone.innerHTML}</div></body></html>`,newWin.document.open(),newWin.document.write(html),newWin.document.close(),newWin.focus(),setTimeout(()=>{var opt={margin:10,filename:`${quiz.title||"report"}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}},element=newWin.document.querySelector(".ntg-quiz-body");html2pdf().set(opt).from(element).save().then(()=>{newWin.close()})},1e3)):alert("Unable to open PDF window")}else alert("html2pdf not loaded")}),copyBtn.addEventListener("click",async()=>{try{var encoded=window.State.encodeState(window.State.currentState),link=window.location.origin+window.location.pathname+"#?state="+encoded;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(link),alert("Link copied to clipboard");else{const ta=document.createElement("textarea");ta.value=link,document.body.appendChild(ta),ta.select(),document.execCommand("copy"),document.body.removeChild(ta),alert("Link copied to clipboard")}}catch(e){alert("Copy failed: "+e.message)}}),printBtn.addEventListener("click",()=>{const contentEl=document.getElementById("quizContent"),clone=contentEl.cloneNode(!0),actionsWrap=clone.querySelector(".results-actions"),stepper=(actionsWrap&&actionsWrap.querySelector("button")&&actionsWrap.remove(),clone.querySelector(".stepper")),navButtons=(stepper&&stepper.remove(),clone.querySelector(".quiz-nav-buttons")),contactButton=(navButtons&&navButtons.remove(),clone.querySelector(".btn.btn-primary.mb-4")),titleElement=(contactButton&&contactButton.remove(),document.createElement("h1")),newWin=(titleElement.textContent=quiz.title||"Business Health Report",titleElement.style.fontSize="24px",titleElement.style.fontWeight="700",titleElement.style.marginBottom="20px",clone.insertBefore(titleElement,clone.firstChild),window.open("","_blank"));var html;newWin?(html=`<!doctype html><html><head><meta charset="utf-8">${Array.from(document.querySelectorAll("link[rel=stylesheet]")).map(l=>`<link rel="stylesheet" href="${l.href}">`).join("\n")}${Array.from(document.querySelectorAll("style")).map(s=>`<style>${s.innerHTML}</style>`).join("\n")}
                <style>
                    @media print {
                        body { margin: 0; padding: 20px; }
                        * { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
                    }
                </style>
            <title>Print - ${quiz.title}</title></head><body><div class="ntg-quiz-body">${clone.innerHTML}</div></body></html>`,newWin.document.open(),newWin.document.write(html),newWin.document.close(),newWin.focus(),setTimeout(()=>{newWin.print()},1e3)):alert("Unable to open print window")}),actionsWrap.appendChild(copyBtn),actionsWrap.appendChild(printBtn),actionsWrap.appendChild(pdfBtn),document.getElementById("pageTitle").appendChild(actionsWrap);try{var appEl=document.getElementById("app"),navUrl=appEl?appEl.dataset.quizMainNavigation:"../assets/data/mainNavigation.json";const nav=await window.JSONCache.get(navUrl),idx=nav.quizzes.findIndex(q=>q.id===quizId),navWrap=document.createElement("div"),prevBtn=(navWrap.className="quiz-nav-buttons",document.createElement("button")),nextBtn=(prevBtn.className="secondary",document.createElement("button"));nextBtn.className="secondary",0<idx?prevBtn.textContent=nav.quizzes[idx-1].title:(prevBtn.textContent="Previous Quiz",prevBtn.disabled=!0),-1!==idx&&idx<nav.quizzes.length-1?nextBtn.textContent=nav.quizzes[idx+1].title:(nextBtn.textContent="Next Quiz",nextBtn.disabled=!0),prevBtn.addEventListener("click",()=>{var prevId;0<idx&&(prevId=nav.quizzes[idx-1].id,window.State.currentState.view="quiz",window.State.currentState.quizId=prevId,window.State.currentState.currentPage=0,window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&(console.log("Scrolling"),quizBody.scrollIntoView({behavior:"smooth",block:"start"}))},100))}),nextBtn.addEventListener("click",()=>{var nextId;idx<nav.quizzes.length-1&&(nextId=nav.quizzes[idx+1].id,window.State.currentState.view="quiz",window.State.currentState.quizId=nextId,window.State.currentState.currentPage=0,window.State.saveStateToUrl(window.State.currentState),setTimeout(()=>{console.log("Scrolling");const quizBody=document.querySelector(".ntg-quiz-body");quizBody&&quizBody.scrollIntoView({behavior:"smooth",block:"start"})},100))}),navWrap.appendChild(prevBtn),navWrap.appendChild(nextBtn),contentEl.appendChild(navWrap)}catch(e){}}}}(),function(global){function getQuizUrl(quizId){var appEl=document.getElementById("app");return appEl&&appEl.dataset[quizId]?appEl.dataset[quizId]:`../assets/data/quizzes/${quizId}.json`}async function route(){var content=document.getElementById("quizContent");if(void 0===window.UI)setTimeout(route,50);else{var appEl=document.getElementById("app"),navUrl=appEl?appEl.dataset.quizMainNavigation:"../assets/data/mainNavigation.json",navUrl=await window.JSONCache.get(navUrl),appEl=appEl?appEl.dataset.uiMessages:"../assets/data/uiMessages.json",appEl=await window.JSONCache.get(appEl),view=window.State&&window.State.currentState&&window.State.currentState.view||"start";if("start"===view)window.State.currentState={view:"start",quizId:null,currentPage:0,answers:{}},window.UI.renderStart(content,appEl);else if("choose-topic"===view)window.UI.renderChooseTopic(content,navUrl);else if("quiz"===view){var navUrl=window.State&&window.State.currentState&&window.State.currentState.quizId||null,pageIndex=window.State&&window.State.currentState&&window.State.currentState.currentPage||0;navUrl?await window.UI.renderQuizPage(content,navUrl,pageIndex):(window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState))}else if("results"===view){const quizId=window.State&&window.State.currentState&&window.State.currentState.quizId||null;quizId?await window.UI.renderResults(content,quizId):(window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState))}else window.State.currentState.view="start",window.UI.renderStart(content,appEl);!async function(){const appEl=document.getElementById("app"),navUrl=appEl?appEl.dataset.quizMainNavigation:"../assets/data/mainNavigation.json",nav=await window.JSONCache.get(navUrl),ul=document.getElementById("quizList"),sideLinks=(ul.innerHTML="",document.getElementById("sideLinks")),btnStart=(sideLinks.innerHTML="",document.createElement("button")),btnChoose=(btnStart.textContent="Get Started",document.createElement("button")),currentView=(btnChoose.textContent="Choose a Topic",window.State&&window.State.currentState&&window.State.currentState.view||"start");"start"===currentView&&btnStart.classList.add("active");"choose-topic"===currentView&&btnChoose.classList.add("active");btnStart.addEventListener("click",()=>{window.State.currentState.view="start",window.State.saveStateToUrl(window.State.currentState)}),btnChoose.addEventListener("click",()=>{window.State.currentState.view="choose-topic",window.State.saveStateToUrl(window.State.currentState)}),sideLinks.appendChild(btnStart),sideLinks.appendChild(btnChoose);var activeQuizId=window.State&&window.State.currentState&&window.State.currentState.quizId||null;for(const q of nav.quizzes){const li=document.createElement("li"),meta=document.createElement("div"),titleLink=(meta.className="quizMeta",document.createElement("a")),prog=(titleLink.className="quizTitle",titleLink.textContent=q.title,titleLink.href="#",titleLink.addEventListener("click",e=>{e.preventDefault(),window.State&&(window.State.currentState.view="quiz",window.State.currentState.quizId=q.id,window.State.currentState.currentPage=0,window.State.currentState.answers||(window.State.currentState.answers={}),window.State.saveStateToUrl(window.State.currentState))}),document.createElement("div"));if(prog.className="quizProgress",prog.textContent="0%",meta.appendChild(titleLink),li.appendChild(meta),li.appendChild(prog),activeQuizId===q.id&&li.classList.add("active"),(async()=>{await window.UI&&window.UI.renderChooseTopic;var percent=await(async()=>{try{var ans,quiz=await window.JSONCache.get(getQuizUrl(q.id)),answers=window.State&&window.State.currentState&&window.State.currentState.answers||{};let total=0,answered=0;for(const page of quiz.pages)for(const question of page.questions)if("group"===question.type&&question.subQuestions)for(const subQ of question.subQuestions)window.Conditional.isVisible(subQ,answers)&&(total++,null!=(ans=answers[subQ.id])&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++);else if(window.Conditional.isVisible(question,answers)){total++;const ans=answers[question.id];void 0!==ans&&null!==ans&&""!==ans&&(!Array.isArray(ans)||0<ans.length)&&answered++}return total?Math.round(answered/total*100):0}catch(e){return 0}})(),isComplete=100===percent;prog.innerHTML=percent+"% "+(isComplete?'<i class="fa-solid fa-circle-check"></i>':'<i class="fa-regular fa-circle"></i>')})(),ul.appendChild(li),activeQuizId===q.id)try{const quiz=await window.JSONCache.get(getQuizUrl(q.id)),pagesList=document.createElement("ol"),answers=(pagesList.className="quiz-pages-list",window.State.currentState&&window.State.currentState.answers||{}),currentPage=window.State.currentState&&window.State.currentState.currentPage||0,liResults=(quiz.pages.forEach((p,idx)=>{const li2=document.createElement("li"),pageLink=(li2.className="page-item",document.createElement("a"));pageLink.href="#",pageLink.textContent=p.title||"Page "+(idx+1),pageLink.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),window.State.currentState.view="quiz",window.State.currentState.currentPage=idx,window.State.saveStateToUrl(window.State.currentState)}),li2.appendChild(pageLink),"quiz"===currentView&&idx===currentPage&&li2.classList.add("active");let pageComplete=!0,pageHasAnswers=!1;for(const qst of p.questions)if("group"===qst.type&&qst.subQuestions)for(const subQ of qst.subQuestions){var ans;window.Conditional.isVisible(subQ,answers)&&(null!=(ans=answers[subQ.id])&&""!==ans?(Array.isArray(ans)&&0<ans.length||!Array.isArray(ans))&&(pageHasAnswers=!0):pageComplete=!1)}else if(window.Conditional.isVisible(qst,answers)){const ans=answers[qst.id];void 0!==ans&&null!==ans&&""!==ans?(Array.isArray(ans)&&0<ans.length||!Array.isArray(ans))&&(pageHasAnswers=!0):pageComplete=!1}pageComplete&&pageHasAnswers?li2.classList.add("completed"):pageHasAnswers&&li2.classList.add("in-progress"),pagesList.appendChild(li2)}),document.createElement("li")),resultsLink=(liResults.className="page-item results-item",document.createElement("a"));resultsLink.href="#",resultsLink.textContent="Your results",resultsLink.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),window.State.currentState.view="results",window.State.saveStateToUrl(window.State.currentState)}),liResults.appendChild(resultsLink),"results"===currentView&&liResults.classList.add("active"),pagesList.appendChild(liResults),ul.appendChild(pagesList)}catch(e){}}}()}}window.addEventListener("hashchange",route),global.Router={route:route}}(window),async function(){document.addEventListener("DOMContentLoaded",async function(){if(document.querySelector("#app.ntg-quiz")){try{await window.JSONCache.init()}catch(error){console.error("Failed to initialize quiz cache:",error)}Modal.init();var existing=State.loadStateFromUrl();existing&&(State.currentState=existing,Modal.show(),document.addEventListener("modal:resume",()=>{Router.route(),setTimeout(()=>{document.body.setAttribute("tabindex","-1"),document.body.focus(),document.body.removeAttribute("tabindex")},100)},{once:!0}),document.addEventListener("modal:fresh",()=>{Modal.hide(),State.clearState(),State.currentState={view:"start",quizId:null,currentPage:0,answers:{}},State.saveStateToUrl(State.currentState),Router.route()},{once:!0})),Router.route()}})}(),function(global){global.AISummaryGenerator=new class{constructor(){this.apiKey=null,this.apiEndpoint="https://api.openai.com/v1/chat/completions",this.model="gpt-4o-mini",this.cache=new Map}init(apiKey){this.apiKey=apiKey}initFromDataAttribute(){var appEl=document.getElementById("app");appEl&&appEl.dataset.openaiApiKey&&(this.apiKey=appEl.dataset.openaiApiKey)}getCacheKey(quizId,answers,overallPercentage){return`${quizId}-${JSON.stringify(answers)}-`+overallPercentage}async generateSummary({quizId,quizTitle,overallPercentage,pageScores,answers,quiz}){if(!this.apiKey)return console.warn("OpenAI API key not configured. Skipping AI summary generation."),null;quizId=this.getCacheKey(quizId,answers,overallPercentage);if(this.cache.has(quizId))return this.cache.get(quizId);try{var errorData,context=this.prepareContext({quizTitle:quizTitle,overallPercentage:overallPercentage,pageScores:pageScores,answers:answers,quiz:quiz});const response=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.apiKey},body:JSON.stringify({model:this.model,messages:[{role:"system",content:'You are a business consultant providing concise, actionable feedback on business health assessments. Generate professional summaries that highlight strengths and areas for improvement. Use Australian English spelling (e.g., "organisation" not "organization", "analyse" not "analyze", "prioritise" not "prioritize").'},{role:"user",content:context}],temperature:.7,max_tokens:150})});if(!response.ok)throw errorData=await response.json(),new Error("OpenAI API error: "+(errorData.error?.message||response.statusText));const data=await response.json();var summaryText=data.choices[0]?.message?.content?.trim();if(!summaryText)throw new Error("No summary generated from OpenAI API");var summary={title:"Summary",content:summaryText};return this.cache.set(quizId,summary),summary}catch(error){return console.error("Error generating AI summary:",error),null}}prepareContext({quizTitle,overallPercentage,pageScores,answers,quiz}){var scoreDescription=this.getScoreDescription(overallPercentage);const strengths=pageScores.filter(ps=>70<=ps.percentage).map(ps=>ps.title),weaknesses=pageScores.filter(ps=>ps.percentage<70).map(ps=>ps.title),insights=this.extractKeyInsights(quiz,answers);return`Generate a professional business health summary for "${quizTitle}" with the following results:

Overall Score: ${overallPercentage}/100
Score Level: ${scoreDescription}

Category Scores:
${pageScores.map(ps=>`- ${ps.title}: ${ps.percentage}% (${ps.score}/${ps.possible})`).join("\n")}

${0<strengths.length?"Strong Areas: "+strengths.join(", "):""}
${0<weaknesses.length?"Areas for Improvement: "+weaknesses.join(", "):""}

Key Insights:
${insights.join("\n")}

Please generate a concise, professional summary (1-2 paragraphs, max 100 words) that:
1. Starts with an overall assessment statement
2. Highlights 1-2 key strengths
3. Identifies 1-2 priority areas for improvement
4. Uses a supportive, actionable tone

Format the response as plain text without markdown formatting or headings.`}getScoreDescription(percentage){return 90<=percentage?"Excellent":75<=percentage?"Good":60<=percentage?"Fair":40<=percentage?"Needs Improvement":"Critical"}extractKeyInsights(quiz,answers){const insights=[];for(const page of quiz.pages)for(const question of page.questions)if("group"===question.type&&question.subQuestions)for(const subQ of question.subQuestions){var answer=answers[subQ.id];"No"!==answer&&"Unsure"!==answer||insights.push(`- ${subQ.label||subQ.question}: `+answer)}else{const answer=answers[question.id];"No"!==answer&&"Unsure"!==answer||insights.push(`- ${question.label||question.question}: `+answer)}return insights.slice(0,5)}clearCache(){this.cache.clear()}}}(window),initMegaMenu(),initResponsiveMenu(),initMmenu(),initSuperfish(),initStickyHeader(),initSideNav(),initScrollToTop(),initResponsiveTable(),initSameHeight(),initFlickity(),initCountUp(),initResponsivePagination(),initLinkCheck(),initAddHoverClassOnCardHover(),initVideoControl(),initQuizUI();